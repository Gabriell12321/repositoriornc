<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Evid√™ncia Indicador RNC</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .chart-header {
            background: #dc2626;
            color: white;
            padding: 15px 20px;
            margin: -20px -20px 20px -20px;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
            font-size: 16px;
        }
        .quarterly-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        .quarter-chart {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        .quarter-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #374151;
            font-size: 16px;
        }
        .chart-canvas {
            height: 250px;
            background: #e9ecef;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
        }
        .percentages-table {
            margin-top: 30px;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .table th, .table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: center;
        }
        .table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        .value-positive { color: #28a745; }
        .value-negative { color: #dc3545; }
        .value-neutral { color: #6c757d; }
    </style>
</head>
<body>
    <h1>üß™ Teste da Nova Se√ß√£o: Evid√™ncia Indicador - RNC</h1>
    
    <div class="test-container">
        <div class="chart-header">
            üìä Evid√™ncia Indicador - RNC
        </div>
        <div style="margin-bottom: 20px; font-size: 14px; color: #64748b;">
            <strong>PERCENTUAL DE CADA FUNCION√ÅRIO EM RELA√á√ÉO √Ä QUANTIDADE DE RNCs NO 1¬∫ E 2¬∫ TRIMESTRES</strong>
        </div>
        
        <!-- Grid para os trimestres -->
        <div class="quarterly-grid">
            <!-- 1¬∫ Trimestre -->
            <div class="quarter-chart">
                <div class="quarter-title">
                    üü¢ 1¬∫ TRIMESTRE (JAN-MAR)
                </div>
                <div class="chart-canvas">
                    <canvas id="firstQuarterChart"></canvas>
                </div>
            </div>
            
            <!-- 2¬∫ Trimestre -->
            <div class="quarter-chart">
                <div class="quarter-title">
                    üîµ 2¬∫ TRIMESTRE (ABR-JUN)
                </div>
                <div class="chart-canvas">
                    <canvas id="secondQuarterChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Tabela de Percentuais -->
        <div class="percentages-table">
            <div style="text-align: center; font-weight: 600; margin-bottom: 15px; color: #374151; font-size: 14px;">
                üìã RESUMO DE PERCENTUAIS POR FUNCION√ÅRIO
            </div>
            <div class="data-table" style="margin: 0;">
                <table class="table">
                    <thead>
                        <tr>
                            <th>FUNCION√ÅRIO</th>
                            <th>1¬∫ TRIMESTRE</th>
                            <th>2¬∫ TRIMESTRE</th>
                            <th>VARIA√á√ÉO</th>
                            <th>PERFORMANCE</th>
                        </tr>
                    </thead>
                    <tbody id="employeePercentagesTable">
                        <!-- Ser√° preenchido dinamicamente -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Dados de teste
        const testData = {
            departments: [
                { name: '√ÅREA CORPORATIVO', realizado: 5, meta: 12 },
                { name: 'CONTROLE', realizado: 13, meta: 15 },
                { name: 'ALAN', realizado: 6, meta: 8 },
                { name: 'MARCELO', realizado: 6, meta: 10 }
            ],
            monthlyData: [
                { month: 'JAN', meta: 15, realizado: 0, acumulado: 0 },
                { month: 'FEV', meta: 15, realizado: 0, acumulado: 0 },
                { month: 'MAR', meta: 15, realizado: 0, acumulado: 0 },
                { month: 'ABR', meta: 15, realizado: 0, acumulado: 0 },
                { month: 'MAI', meta: 15, realizado: 0, acumulado: 0 },
                { month: 'JUN', meta: 15, realizado: 5, acumulado: 5 }
            ]
        };

        // Fun√ß√£o para criar gr√°ficos dos trimestres
        function createQuarterlyCharts(data) {
            console.log('üìä Criando gr√°ficos dos trimestres...');
            
            createFirstQuarterChart(data);
            createSecondQuarterChart(data);
            updateEmployeePercentagesTable(data);
        }

        // Gr√°fico do 1¬∫ Trimestre
        function createFirstQuarterChart(data) {
            const chartElement = document.getElementById('firstQuarterChart');
            if (!chartElement) {
                console.error('‚ùå Elemento firstQuarterChart n√£o encontrado!');
                return;
            }
            
            const ctx = chartElement.getContext('2d');
            
            // Calcular dados do 1¬∫ trimestre (JAN-MAR)
            const firstQuarterData = data.monthlyData.slice(0, 3);
            const totalFirstQuarter = firstQuarterData.reduce((sum, d) => sum + d.realizado, 0);
            
            // Simular dados por funcion√°rio
            const employees = data.departments.map(dept => ({
                name: dept.name,
                rncs: Math.round(dept.realizado * 0.3)
            }));

            try {
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: employees.map(e => e.name),
                        datasets: [{
                            data: employees.map(e => e.rncs),
                            backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444'],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '60%',
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { padding: 15, usePointStyle: true }
                            },
                            title: {
                                display: true,
                                text: `Total: ${totalFirstQuarter} RNCs`,
                                position: 'bottom',
                                padding: 20
                            }
                        }
                    }
                });
                
                console.log('‚úÖ Gr√°fico do 1¬∫ trimestre criado');
            } catch (error) {
                console.error('‚ùå Erro ao criar gr√°fico do 1¬∫ trimestre:', error);
            }
        }

        // Gr√°fico do 2¬∫ Trimestre
        function createSecondQuarterChart(data) {
            const chartElement = document.getElementById('secondQuarterChart');
            if (!chartElement) {
                console.error('‚ùå Elemento secondQuarterChart n√£o encontrado!');
                return;
            }
            
            const ctx = chartElement.getContext('2d');
            
            // Calcular dados do 2¬∫ trimestre (ABR-JUN)
            const secondQuarterData = data.monthlyData.slice(3, 6);
            const totalSecondQuarter = secondQuarterData.reduce((sum, d) => sum + d.realizado, 0);
            
            // Simular dados por funcion√°rio
            const employees = data.departments.map(dept => ({
                name: dept.name,
                rncs: Math.round(dept.realizado * 0.4)
            }));

            try {
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: employees.map(e => e.name),
                        datasets: [{
                            data: employees.map(e => e.rncs),
                            backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444'],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '60%',
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { padding: 15, usePointStyle: true }
                            },
                            title: {
                                display: true,
                                text: `Total: ${totalSecondQuarter} RNCs`,
                                position: 'bottom',
                                padding: 20
                            }
                        }
                    }
                });
                
                console.log('‚úÖ Gr√°fico do 2¬∫ trimestre criado');
            } catch (error) {
                console.error('‚ùå Erro ao criar gr√°fico do 2¬∫ trimestre:', error);
            }
        }

        // Atualizar tabela de percentuais
        function updateEmployeePercentagesTable(data) {
            const tbody = document.getElementById('employeePercentagesTable');
            if (!tbody) {
                console.error('‚ùå Elemento employeePercentagesTable n√£o encontrado!');
                return;
            }
            
            tbody.innerHTML = '';

            // Calcular totais dos trimestres
            const firstQuarterTotal = data.monthlyData.slice(0, 3).reduce((sum, d) => sum + d.realizado, 0);
            const secondQuarterTotal = data.monthlyData.slice(3, 6).reduce((sum, d) => sum + d.realizado, 0);

            data.departments.forEach(dept => {
                // Simular RNCs por trimestre
                const firstQuarterRNCs = Math.round(dept.realizado * 0.3);
                const secondQuarterRNCs = Math.round(dept.realizado * 0.4);
                
                // Calcular percentuais
                const firstQuarterPercent = firstQuarterTotal > 0 ? (firstQuarterRNCs / firstQuarterTotal * 100).toFixed(1) : 0;
                const secondQuarterPercent = secondQuarterTotal > 0 ? (secondQuarterRNCs / secondQuarterTotal * 100).toFixed(1) : 0;
                
                // Calcular varia√ß√£o
                const variation = ((secondQuarterPercent - firstQuarterPercent) / firstQuarterPercent * 100).toFixed(1);
                const variationText = variation === 'Infinity' || variation === '-Infinity' ? '0%' : variation + '%';
                
                // Determinar performance
                let performance = 'üü¢ Melhorou';
                let performanceClass = 'value-positive';
                
                if (secondQuarterPercent < firstQuarterPercent) {
                    performance = 'üî¥ Piorou';
                    performanceClass = 'value-negative';
                } else if (secondQuarterPercent === firstQuarterPercent) {
                    performance = 'üü° Manteve';
                    performanceClass = 'value-neutral';
                }

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="font-weight: 600; color: #374151;">${dept.name}</td>
                    <td class="value-positive">${firstQuarterPercent}% (${firstQuarterRNCs} RNCs)</td>
                    <td class="value-positive">${secondQuarterPercent}% (${secondQuarterRNCs} RNCs)</td>
                    <td class="${variation >= 0 ? 'value-positive' : 'value-negative'}">${variationText}</td>
                    <td class="${performanceClass}">${performance}</td>
                `;
                tbody.appendChild(row);
            });
            
            console.log('‚úÖ Tabela de percentuais atualizada');
        }

        // Inicializar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Iniciando teste da nova se√ß√£o...');
            createQuarterlyCharts(testData);
        });
    </script>
</body>
</html>
