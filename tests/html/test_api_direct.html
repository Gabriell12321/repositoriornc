<!DOCTYPE html>
<html>
<head>
    <title>Teste API de GrÃ¡ficos - IPPEL</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .container { background: white; padding: 20px; border-radius: 8px; margin: 10px 0; }
        .success { color: green; } .error { color: red; } .info { color: blue; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; background: #007bff; color: white; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Teste da API de GrÃ¡ficos - IPPEL RNC</h1>
        <button onclick="testAPI()">Testar API de Dados</button>
        <button onclick="testOldAPI()">Testar API Original (com auth)</button>
        <button onclick="clearLog()">Limpar Log</button>
        
        <div id="results"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            resultsDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
        }

        function clearLog() {
            document.getElementById('results').innerHTML = '';
        }

        async function testAPI() {
            log('ğŸ”„ Testando API de teste sem autenticaÃ§Ã£o...');
            
            try {
                const url = '/api/test/charts-data?period=30';
                log(`ğŸ“¡ Fazendo requisiÃ§Ã£o para: ${url}`);
                
                const response = await fetch(url);
                log(`ğŸ“Š Status da resposta: ${response.status}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                log('âœ… Dados recebidos com sucesso!', 'success');
                log(`ğŸ“‹ Resumo dos dados:`, 'info');
                log(`  - Total de RNCs: ${data.kpis?.total || 'N/A'}`, 'info');
                log(`  - RNCs Pendentes: ${data.kpis?.pending || 'N/A'}`, 'info');
                log(`  - RNCs Finalizadas: ${data.kpis?.resolved || 'N/A'}`, 'info');
                log(`  - Status diferentes: ${data.status?.length || 0}`, 'info');
                log(`  - Pontos de tendÃªncia: ${data.trend?.length || 0}`, 'info');
                
                // Mostrar dados completos
                const pre = document.createElement('pre');
                pre.textContent = JSON.stringify(data, null, 2);
                pre.style.maxHeight = '300px';
                pre.style.overflow = 'auto';
                document.getElementById('results').appendChild(pre);
                
            } catch (error) {
                log(`âŒ Erro: ${error.message}`, 'error');
            }
        }

        async function testOldAPI() {
            log('ğŸ”„ Testando API original com autenticaÃ§Ã£o...');
            
            try {
                const url = '/api/charts/enhanced-data?period=30&department=all';
                log(`ğŸ“¡ Fazendo requisiÃ§Ã£o para: ${url}`);
                
                const response = await fetch(url);
                log(`ğŸ“Š Status da resposta: ${response.status}`);
                
                const data = await response.json();
                
                if (response.status === 401) {
                    log('ğŸ”’ Erro de autenticaÃ§Ã£o - usuÃ¡rio nÃ£o estÃ¡ logado', 'error');
                    log('ğŸ’¡ Isso Ã© esperado se nÃ£o estiver logado no sistema', 'info');
                } else if (response.ok) {
                    log('âœ… API original funcionando!', 'success');
                    const pre = document.createElement('pre');
                    pre.textContent = JSON.stringify(data, null, 2);
                    document.getElementById('results').appendChild(pre);
                } else {
                    log(`âŒ Erro: ${data.message || 'Erro desconhecido'}`, 'error');
                }
                
            } catch (error) {
                log(`âŒ Erro: ${error.message}`, 'error');
            }
        }

        // Executar teste automÃ¡tico ao carregar
        window.onload = function() {
            log('ğŸš€ PÃ¡gina carregada, executando teste automÃ¡tico...');
            setTimeout(testAPI, 1000);
        };
    </script>
</body>
</html>
