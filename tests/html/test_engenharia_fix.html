<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Teste Engenharia Fix</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .kpi-card { background: #f1f5f9; padding: 16px; border-radius: 12px; margin: 10px; display: inline-block; width: 200px; }
        .kpi-value { font-size: 26px; font-weight: 700; color: #10b981; }
        .button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 10px; }
    </style>
</head>
<body>
    <h1>Teste Corre√ß√£o Engenharia</h1>
    
    <button class="button" onclick="testServer()">Testar Servidor</button>
    <button class="button" onclick="loadIndicadoresEngenharia()">Carregar Dados Engenharia</button>
    <button class="button" onclick="testElementSelection()">Testar Sele√ß√£o de Elementos</button>
    
    <div style="margin-top: 20px;">
        <h3>KPIs de Engenharia:</h3>
        
        <div class="kpi-card">
            <div>Backlog T√©cnico</div>
            <div class="kpi-value" id="engBacklogKpi">--</div>
        </div>
        
        <div class="kpi-card">
            <div>Lead Time M√©dio</div>
            <div class="kpi-value" id="engLeadtimeKpi">--</div>
        </div>
        
        <div class="kpi-card">
            <div>RNC Origem Engenharia</div>
            <div class="kpi-value" id="engRncsKpi">--</div>
        </div>
        
        <div class="kpi-card">
            <div>Taxa de Retrabalho</div>
            <div class="kpi-value" id="engRetrabalhoKpi">--</div>
        </div>
    </div>
    
    <div id="log" style="margin-top: 20px; background: #f8f9fa; padding: 10px; border-radius: 5px; max-height: 400px; overflow-y: auto;"></div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${time}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function testElementSelection() {
            log('üîç Testando sele√ß√£o de elementos...');
            
            const elements = ['engBacklogKpi', 'engLeadtimeKpi', 'engRncsKpi', 'engRetrabalhoKpi'];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    log(`‚úÖ Elemento ${id} encontrado: ${element.tagName} com texto: "${element.textContent}"`);
                    element.textContent = 'TESTE';
                    element.style.background = '#28a745';
                    element.style.color = 'white';
                } else {
                    log(`‚ùå Elemento ${id} N√ÉO encontrado!`);
                }
            });
        }
        
        async function testServer() {
            log('üß™ Testando conex√£o com servidor...');
            
            try {
                const response = await fetch('/api/test');
                const data = await response.json();
                log(`‚úÖ Servidor respondeu: ${JSON.stringify(data)}`);
            } catch (error) {
                log(`‚ùå Erro ao testar servidor: ${error.message}`);
            }
        }
        
        async function loadIndicadoresEngenharia() {
            log('üöÄ Iniciando loadIndicadoresEngenharia()...');
            
            try {
                log('üì° Fazendo requisi√ß√£o para /api/indicadores/engenharia...');
                
                const response = await fetch('/api/indicadores/engenharia', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                log(`üìä Status da resposta: ${response.status}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                log(`üì¶ Dados recebidos: ${JSON.stringify(data)}`);
                
                // Atualizar elementos
                const updates = [
                    { id: 'engBacklogKpi', value: data.acumulado_total || 0 },
                    { id: 'engLeadtimeKpi', value: data.lead_time_medio || 0 },
                    { id: 'engRncsKpi', value: data.acumulado_total || 0 },
                    { id: 'engRetrabalhoKpi', value: data.taxa_retrabalho || 0 }
                ];
                
                updates.forEach(update => {
                    const element = document.getElementById(update.id);
                    if (element) {
                        element.textContent = update.value;
                        element.style.background = '#28a745';
                        element.style.color = 'white';
                        log(`‚úÖ ${update.id} atualizado para: ${update.value}`);
                    } else {
                        log(`‚ùå Elemento ${update.id} n√£o encontrado para atualiza√ß√£o!`);
                    }
                });
                
                log('üéâ loadIndicadoresEngenharia() conclu√≠da com sucesso!');
                
            } catch (error) {
                log(`‚ùå Erro em loadIndicadoresEngenharia(): ${error.message}`);
                console.error('Erro completo:', error);
            }
        }
        
        // Log inicial
        log('üìã P√°gina de teste carregada. Pronto para testar!');
    </script>
</body>
</html>
