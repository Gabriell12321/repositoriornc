<!DOCTYPE html>
<html>
<head>
    <title>IPPEL RNC - Dashboard Teste Simplificado</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f0f0f0; }
        .tab-button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .tab-button.active { background: #28a745; }
        .container { background: white; padding: 20px; border-radius: 8px; margin: 10px 0; }
        .charts-container { display: none; }
        .charts-container.active { display: block; }
        canvas { width: 100%; height: 300px; }
    </style>
</head>
<body>
    <h1>IPPEL RNC System - Teste Simplificado</h1>
    
    <div class="container">
        <h2>NavegaÃ§Ã£o</h2>
        <button class="tab-button active" onclick="switchTab('home')">ğŸ  InÃ­cio</button>
        <button class="tab-button" onclick="switchTab('charts')">ğŸ“Š GrÃ¡ficos</button>
        <button class="tab-button" onclick="switchTab('indicadores')">ğŸ“ˆ Indicadores</button>
    </div>

    <div id="homeContainer" class="container">
        <h2>ğŸ  InÃ­cio</h2>
        <p>Bem-vindo ao sistema IPPEL RNC. Use os botÃµes acima para navegar.</p>
        <button onclick="testFunctions()">ğŸ§ª Testar FunÃ§Ãµes</button>
        <div id="testResults"></div>
    </div>

    <div id="chartsContainer" class="container charts-container">
        <h2>ğŸ“Š GrÃ¡ficos</h2>
        <select id="chartPeriod" onchange="loadChartData()">
            <option value="30">Ãšltimos 30 dias</option>
            <option value="90">Ãšltimos 90 dias</option>
            <option value="all">Todos os dados</option>
        </select>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
            <div>
                <h3>GrÃ¡fico de Status</h3>
                <canvas id="statusChart"></canvas>
            </div>
            <div>
                <h3>GrÃ¡fico de TendÃªncia</h3>
                <canvas id="trendChart"></canvas>
            </div>
        </div>
    </div>

    <div id="indicadoresContainer" class="container charts-container">
        <h2>ğŸ“ˆ Indicadores</h2>
        <p>Indicadores serÃ£o exibidos aqui.</p>
    </div>

    <script>
        // VariÃ¡veis globais
        let charts = {};
        let currentTab = 'home';

        // FUNÃ‡ÃƒO PRINCIPAL: switchTab
        function switchTab(tab) {
            console.log(`ğŸ”„ Alternando para aba: ${tab}`);
            
            // Atualizar botÃµes
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeButton = document.querySelector(`button[onclick="switchTab('${tab}')"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }

            // Mostrar/ocultar containers
            document.querySelectorAll('.charts-container').forEach(container => {
                container.style.display = 'none';
            });
            
            document.getElementById('homeContainer').style.display = 'none';

            currentTab = tab;

            if (tab === 'home') {
                document.getElementById('homeContainer').style.display = 'block';
            } else if (tab === 'charts') {
                document.getElementById('chartsContainer').style.display = 'block';
                console.log('ğŸ“Š Carregando grÃ¡ficos...');
                loadChartData();
            } else if (tab === 'indicadores') {
                document.getElementById('indicadoresContainer').style.display = 'block';
                console.log('ğŸ“ˆ Carregando indicadores...');
            }
        }

        // FUNÃ‡ÃƒO: loadChartData  
        function loadChartData() {
            const period = document.getElementById('chartPeriod').value;
            console.log(`ğŸ“Š Carregando dados para perÃ­odo: ${period}`);
            
            // SimulaÃ§Ã£o de dados
            const simulatedData = {
                status: [
                    { label: 'Aberta', count: 25, color: '#ff6b6b' },
                    { label: 'Em AnÃ¡lise', count: 18, color: '#4ecdc4' },
                    { label: 'Finalizada', count: 42, color: '#96ceb4' }
                ],
                trend: [
                    { date: '2024-08-01', count: 5 },
                    { date: '2024-08-02', count: 8 },
                    { date: '2024-08-03', count: 3 },
                    { date: '2024-08-04', count: 12 },
                    { date: '2024-08-05', count: 7 }
                ]
            };

            createCharts(simulatedData);
        }

        // FUNÃ‡ÃƒO: createCharts
        function createCharts(data) {
            console.log('ğŸ¨ Criando grÃ¡ficos...', data);

            // Destruir grÃ¡ficos existentes
            Object.values(charts).forEach(chart => {
                if (chart && typeof chart.destroy === 'function') {
                    chart.destroy();
                }
            });
            charts = {};

            // Verificar se Chart.js estÃ¡ disponÃ­vel
            if (typeof Chart === 'undefined') {
                console.error('âŒ Chart.js nÃ£o disponÃ­vel!');
                return;
            }

            // Criar grÃ¡fico de status
            const statusCtx = document.getElementById('statusChart');
            if (statusCtx) {
                charts.status = new Chart(statusCtx, {
                    type: 'doughnut',
                    data: {
                        labels: data.status.map(s => s.label),
                        datasets: [{
                            data: data.status.map(s => s.count),
                            backgroundColor: data.status.map(s => s.color)
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
                console.log('âœ… GrÃ¡fico de status criado');
            }

            // Criar grÃ¡fico de tendÃªncia
            const trendCtx = document.getElementById('trendChart');
            if (trendCtx) {
                charts.trend = new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: data.trend.map(t => t.date),
                        datasets: [{
                            label: 'RNCs por Dia',
                            data: data.trend.map(t => t.count),
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
                console.log('âœ… GrÃ¡fico de tendÃªncia criado');
            }
        }

        // FUNÃ‡ÃƒO: testFunctions
        function testFunctions() {
            const resultsDiv = document.getElementById('testResults');
            let results = '<h3>ğŸ§ª Resultados dos Testes:</h3>';
            
            // Testar se funÃ§Ãµes estÃ£o disponÃ­veis
            const functions = ['switchTab', 'loadChartData', 'createCharts'];
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    results += `<p style="color: green;">âœ… ${funcName} estÃ¡ disponÃ­vel globalmente</p>`;
                } else {
                    results += `<p style="color: red;">âŒ ${funcName} NÃƒO estÃ¡ disponÃ­vel globalmente</p>`;
                }
            });

            // Testar Chart.js
            if (typeof Chart !== 'undefined') {
                results += `<p style="color: green;">âœ… Chart.js disponÃ­vel (v${Chart.version})</p>`;
            } else {
                results += `<p style="color: red;">âŒ Chart.js NÃƒO disponÃ­vel</p>`;
            }

            resultsDiv.innerHTML = results;
        }

        // EXPOSIÃ‡ÃƒO GLOBAL DAS FUNÃ‡Ã•ES
        window.switchTab = switchTab;
        window.loadChartData = loadChartData;
        window.createCharts = createCharts;
        window.testFunctions = testFunctions;

        console.log('ğŸš€ Sistema de teste carregado!');
        console.log('âœ… FunÃ§Ãµes disponÃ­veis:', Object.keys(window).filter(key => typeof window[key] === 'function' && ['switchTab', 'loadChartData', 'createCharts'].includes(key)));
    </script>
</body>
</html>
