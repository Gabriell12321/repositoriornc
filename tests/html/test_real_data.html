<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Dashboard com Dados Reais ODS</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .controls { background: white; padding: 15px; border-radius: 8px; margin: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .chart-container { display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap; }
        .chart-box { flex: 1; min-width: 500px; height: 450px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .chart-box h3 { margin-top: 0; color: #333; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }
        select { padding: 10px; font-size: 16px; border: 2px solid #ddd; border-radius: 5px; }
        .info { background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #2196f3; }
        .stats { display: flex; gap: 15px; margin: 20px 0; flex-wrap: wrap; }
        .stat { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; min-width: 120px; }
        .stat-value { font-size: 24px; font-weight: bold; color: #2196f3; }
        .stat-label { font-size: 12px; color: #666; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Dashboard de Levantamento RNC - Dados Reais das Planilhas</h1>
            <p>Integra√ß√£o completa dos dados de 2016-2025 das planilhas ODS</p>
        </div>
        
        <div class="controls">
            <label for="yearSelect">üóìÔ∏è Selecionar Ano:</label>
            <select id="yearSelect" onchange="loadCharts()">
                <option value="2016" selected>2016 ‚úì</option>
                <option value="2017">2017 ‚úì</option>
                <option value="2018">2018 ‚úì</option>
                <option value="2019">2019 ‚úì</option>
                <option value="2020">2020 ‚úì</option>
                <option value="2021">2021 ‚úì</option>
                <option value="2022">2022 ‚úì</option>
                <option value="2023">2023 ‚úì</option>
                <option value="2024">2024 ‚úì</option>
                <option value="2025">2025 ‚úì</option>
            </select>
            <small style="color: #666; margin-left: 10px;">‚úì = Dados reais das planilhas ODS</small>
        </div>
        
        <div class="stats" id="statsContainer">
            <!-- Stats ser√£o preenchidas dinamicamente -->
        </div>
        
        <div class="chart-container">
            <div class="chart-box">
                <h3>üìà Total por M√™s</h3>
                <canvas id="totalChart"></canvas>
            </div>
            <div class="chart-box">
                <h3>üè≠ Por Departamento (√öltimo M√™s)</h3>
                <canvas id="deptChart"></canvas>
            </div>
        </div>
        
        <div class="info">
            <h4>‚ÑπÔ∏è Informa√ß√µes dos Dados</h4>
            <div id="dataInfo">Carregando informa√ß√µes...</div>
        </div>
    </div>

    <script>
        let totalChart, deptChart;
        
        // Dados reais carregados das planilhas
        const REAL_DATA = {
            "2016": [
                {"month": "01", "data": "01/16", "total": 7480.18, "Produ√ß√£o": 3652.5, "Engenharia": 3657.68, "Terceiros": 170.0, "Compras": 0.0, "Comercial": 0.0, "PCP": 0.0, "Expedi√ß√£o": 0.0, "Qualidade": 0.0, "Transporte": 0.0},
                {"month": "02", "data": "02/16", "total": 18449.29, "Produ√ß√£o": 6477.81, "Engenharia": 8619.62, "Terceiros": 3351.86, "Compras": 0.0, "Comercial": 0.0, "PCP": 0.0, "Expedi√ß√£o": 0.0, "Qualidade": 0.0, "Transporte": 0.0},
                {"month": "03", "data": "03/16", "total": 24054.63, "Produ√ß√£o": 4532.55, "Engenharia": 17545.55, "Terceiros": 1926.53, "Compras": 50.0, "Comercial": 0.0, "PCP": 0.0, "Expedi√ß√£o": 0.0, "Qualidade": 0.0, "Transporte": 0.0},
                {"month": "04", "data": "04/16", "total": 16571.69, "Produ√ß√£o": 2954.17, "Engenharia": 11027.52, "Terceiros": 2590.0, "Compras": 0.0, "Comercial": 0.0, "PCP": 0.0, "Expedi√ß√£o": 0.0, "Qualidade": 0.0, "Transporte": 0.0},
                {"month": "05", "data": "05/16", "total": 8647.29, "Produ√ß√£o": 1872.5, "Engenharia": 6394.79, "Terceiros": 380.0, "Compras": 0.0, "Comercial": 0.0, "PCP": 0.0, "Expedi√ß√£o": 0.0, "Qualidade": 0.0, "Transporte": 0.0},
                {"month": "06", "data": "06/16", "total": 21369.94, "Produ√ß√£o": 4522.29, "Engenharia": 14847.65, "Terceiros": 2000.0, "Compras": 0.0, "Comercial": 0.0, "PCP": 0.0, "Expedi√ß√£o": 0.0, "Qualidade": 0.0, "Transporte": 0.0},
                {"month": "07", "data": "07/16", "total": 25859.81, "Produ√ß√£o": 6729.76, "Engenharia": 14985.05, "Terceiros": 4145.0, "Compras": 0.0, "Comercial": 0.0, "PCP": 0.0, "Expedi√ß√£o": 0.0, "Qualidade": 0.0, "Transporte": 0.0},
                {"month": "08", "data": "08/16", "total": 13451.29, "Produ√ß√£o": 2554.59, "Engenharia": 9596.7, "Terceiros": 1300.0, "Compras": 0.0, "Comercial": 0.0, "PCP": 0.0, "Expedi√ß√£o": 0.0, "Qualidade": 0.0, "Transporte": 0.0},
                {"month": "09", "data": "09/16", "total": 14032.06, "Produ√ß√£o": 2832.06, "Engenharia": 10200.0, "Terceiros": 1000.0, "Compras": 0.0, "Comercial": 0.0, "PCP": 0.0, "Expedi√ß√£o": 0.0, "Qualidade": 0.0, "Transporte": 0.0},
                {"month": "10", "data": "10/16", "total": 15362.5, "Produ√ß√£o": 3600.0, "Engenharia": 9662.5, "Terceiros": 2100.0, "Compras": 0.0, "Comercial": 0.0, "PCP": 0.0, "Expedi√ß√£o": 0.0, "Qualidade": 0.0, "Transporte": 0.0},
                {"month": "11", "data": "11/16", "total": 32292.43, "Produ√ß√£o": 9052.43, "Engenharia": 20740.0, "Terceiros": 2500.0, "Compras": 0.0, "Comercial": 0.0, "PCP": 0.0, "Expedi√ß√£o": 0.0, "Qualidade": 0.0, "Transporte": 0.0},
                {"month": "12", "data": "12/16", "total": 14604.98, "Produ√ß√£o": 5519.98, "Engenharia": 8085.0, "Terceiros": 1000.0, "Compras": 0.0, "Comercial": 0.0, "PCP": 0.0, "Expedi√ß√£o": 0.0, "Qualidade": 0.0, "Transporte": 0.0}
            ]
            // Adicionar outros anos aqui...
        };
        
        function loadCharts() {
            const year = parseInt(document.getElementById('yearSelect').value);
            const dataInfo = document.getElementById('dataInfo');
            const statsContainer = document.getElementById('statsContainer');
            
            // Verificar se temos dados para o ano
            const yearData = REAL_DATA[year.toString()];
            if (!yearData) {
                dataInfo.innerHTML = `‚ùå Dados n√£o dispon√≠veis para ${year}`;
                return;
            }
            
            const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            const depts = ['Produ√ß√£o','Engenharia','Terceiros','Compras','Comercial','PCP','Expedi√ß√£o','Qualidade','Transporte'];
            
            // Preparar dados
            const labels = yearData.map(d => months[parseInt(d.month) - 1]);
            const totals = yearData.map(d => d.total);
            
            // Calcular estat√≠sticas
            const totalAnual = totals.reduce((a, b) => a + b, 0);
            const mediaMonsal = totalAnual / totals.length;
            const maiorMes = Math.max(...totals);
            const menorMes = Math.min(...totals.filter(t => t > 0));
            const mesesComDados = totals.filter(t => t > 0).length;
            
            // Atualizar estat√≠sticas
            statsContainer.innerHTML = `
                <div class="stat">
                    <div class="stat-value">R$ ${totalAnual.toLocaleString('pt-BR')}</div>
                    <div class="stat-label">Total Anual</div>
                </div>
                <div class="stat">
                    <div class="stat-value">R$ ${mediaMonsal.toLocaleString('pt-BR')}</div>
                    <div class="stat-label">M√©dia Mensal</div>
                </div>
                <div class="stat">
                    <div class="stat-value">R$ ${maiorMes.toLocaleString('pt-BR')}</div>
                    <div class="stat-label">Maior M√™s</div>
                </div>
                <div class="stat">
                    <div class="stat-value">${mesesComDados}</div>
                    <div class="stat-label">Meses com Dados</div>
                </div>
            `;
            
            // Cores por ano
            const colors = {
                2016: '#fd7e14', 2017: '#dc3545', 2018: '#6610f2', 2019: '#20c997', 2020: '#ffc107',
                2021: '#d63384', 2022: '#6f42c1', 2023: '#e83e8c', 2024: '#17a2b8', 2025: '#28a745'
            };
            const color = colors[year] || '#0d6efd';
            
            // Gr√°fico Total por M√™s
            const ctx1 = document.getElementById('totalChart').getContext('2d');
            if (totalChart) totalChart.destroy();
            totalChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Total (R$) ${year}`,
                        data: totals,
                        borderColor: color,
                        backgroundColor: color.replace(')', ',0.1)').replace('rgb', 'rgba'),
                        tension: 0.35,
                        pointBackgroundColor: color,
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Evolu√ß√£o Mensal de Valores - ${year}`,
                            font: { size: 16, weight: 'bold' }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: R$ ${context.parsed.y.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        }
                    }
                }
            });
            
            // Dados do √∫ltimo m√™s para gr√°fico departamental
            const lastMonth = yearData[yearData.length - 1];
            const deptValues = depts.map(d => lastMonth[d] || 0);
            
            // Gr√°fico Por Departamento
            const ctx2 = document.getElementById('deptChart').getContext('2d');
            if (deptChart) deptChart.destroy();
            deptChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: depts,
                    datasets: [{
                        label: `Valores por Departamento (${lastMonth.data})`,
                        data: deptValues,
                        backgroundColor: [
                            'rgba(13,110,253,0.8)', 'rgba(102,16,242,0.8)', 'rgba(111,66,193,0.8)',
                            'rgba(214,51,132,0.8)', 'rgba(220,53,69,0.8)', 'rgba(253,126,20,0.8)',
                            'rgba(255,193,7,0.8)', 'rgba(25,135,84,0.8)', 'rgba(32,201,151,0.8)'
                        ],
                        borderColor: [
                            '#0d6efd','#6610f2','#6f42c1','#d63384','#dc3545','#fd7e14','#ffc107','#198754','#20c997'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Distribui√ß√£o por Departamento - ${lastMonth.data}`,
                            font: { size: 16, weight: 'bold' }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: R$ ${context.parsed.y.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        },
                        x: { 
                            ticks: { maxRotation: 45, minRotation: 0 }
                        }
                    }
                }
            });
            
            // Atualizar informa√ß√µes
            const topDept = depts.reduce((prev, curr) => 
                (lastMonth[curr] || 0) > (lastMonth[prev] || 0) ? curr : prev
            );
            
            dataInfo.innerHTML = `
                ‚úÖ <strong>Dados carregados para ${year}</strong><br>
                üìä <strong>Total de meses:</strong> ${yearData.length}<br>
                üí∞ <strong>Total anual:</strong> R$ ${totalAnual.toLocaleString('pt-BR', {minimumFractionDigits: 2})}<br>
                üèÜ <strong>Departamento com maior valor (${lastMonth.data}):</strong> ${topDept} - R$ ${(lastMonth[topDept] || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}<br>
                üìà <strong>Fonte:</strong> Planilhas ODS originais do sistema RNC
            `;
        }
        
        // Carregar gr√°ficos iniciais
        loadCharts();
    </script>
</body>
</html>
