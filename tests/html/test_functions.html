<!DOCTYPE html>
<html>
<head>
    <title>Teste das Fun√ß√µes de Gr√°ficos</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .test-section { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .success { color: green; } .error { color: red; } .warning { color: orange; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
    </style>
</head>
<body>
    <h1>üß™ Teste das Fun√ß√µes de Gr√°ficos - IPPEL RNC</h1>
    
    <div class="test-section">
        <h2>üîó Testes de Conectividade</h2>
        <button class="btn-primary" onclick="testAPI()">Testar API de Gr√°ficos</button>
        <button class="btn-primary" onclick="testChartJS()">Testar Chart.js</button>
        <div id="connectivityResults"></div>
    </div>

    <div class="test-section">
        <h2>‚öôÔ∏è Testes de Fun√ß√µes JavaScript</h2>
        <button class="btn-success" onclick="testSwitchTab()">Testar switchTab</button>
        <button class="btn-success" onclick="testLoadChartData()">Testar loadChartData</button>
        <button class="btn-success" onclick="testUpdateHeatmap()">Testar updateHeatmap</button>
        <div id="functionResults"></div>
    </div>

    <div class="test-section">
        <h2>üéØ Simula√ß√£o de Clique em Aba Gr√°ficos</h2>
        <button class="btn-danger" onclick="simulateGraphicsTab()">Simular Clique na Aba Gr√°ficos</button>
        <div id="simulationResults"></div>
    </div>

    <div class="test-section">
        <h2>üìù Log de Console</h2>
        <div id="consoleLog" style="background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; height: 200px; overflow-y: auto;"></div>
    </div>

    <script>
        // Capturar logs do console
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const originalConsoleWarn = console.warn;
        
        function addToLog(type, message) {
            const logDiv = document.getElementById('consoleLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div class="${type}">[${timestamp}] ${type.toUpperCase()}: ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            addToLog('success', args.join(' '));
        };
        
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            addToLog('error', args.join(' '));
        };
        
        console.warn = function(...args) {
            originalConsoleWarn.apply(console, args);
            addToLog('warning', args.join(' '));
        };

        function testAPI() {
            const resultsDiv = document.getElementById('connectivityResults');
            resultsDiv.innerHTML = '<div>üîÑ Testando API...</div>';
            
            fetch('http://192.168.3.11:5001/api/charts/enhanced-data?period=30&department=all')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('‚úÖ API funcionando:', data);
                    resultsDiv.innerHTML = `<div class="success">‚úÖ API funcionando! Retornou ${Object.keys(data).length} propriedades</div>`;
                })
                .catch(error => {
                    console.error('‚ùå Erro na API:', error);
                    resultsDiv.innerHTML = `<div class="error">‚ùå Erro na API: ${error.message}</div>`;
                });
        }

        function testChartJS() {
            const resultsDiv = document.getElementById('connectivityResults');
            if (typeof Chart !== 'undefined') {
                console.log('‚úÖ Chart.js dispon√≠vel, vers√£o:', Chart.version);
                resultsDiv.innerHTML += `<div class="success">‚úÖ Chart.js dispon√≠vel (v${Chart.version})</div>`;
            } else {
                console.error('‚ùå Chart.js n√£o dispon√≠vel');
                resultsDiv.innerHTML += `<div class="error">‚ùå Chart.js n√£o dispon√≠vel</div>`;
            }
        }

        function testSwitchTab() {
            const resultsDiv = document.getElementById('functionResults');
            if (typeof window.switchTab === 'function') {
                console.log('‚úÖ switchTab definida como fun√ß√£o global');
                resultsDiv.innerHTML = '<div class="success">‚úÖ switchTab acess√≠vel globalmente</div>';
            } else {
                console.error('‚ùå switchTab n√£o est√° definida globalmente');
                resultsDiv.innerHTML = '<div class="error">‚ùå switchTab n√£o acess√≠vel</div>';
            }
        }

        function testLoadChartData() {
            const resultsDiv = document.getElementById('functionResults');
            if (typeof window.loadChartData === 'function') {
                console.log('‚úÖ loadChartData definida como fun√ß√£o global');
                resultsDiv.innerHTML += '<div class="success">‚úÖ loadChartData acess√≠vel globalmente</div>';
            } else {
                console.error('‚ùå loadChartData n√£o est√° definida globalmente');
                resultsDiv.innerHTML += '<div class="error">‚ùå loadChartData n√£o acess√≠vel</div>';
            }
        }

        function testUpdateHeatmap() {
            const resultsDiv = document.getElementById('functionResults');
            if (typeof window.updateHeatmap === 'function') {
                console.log('‚úÖ updateHeatmap definida como fun√ß√£o global');
                resultsDiv.innerHTML += '<div class="success">‚úÖ updateHeatmap acess√≠vel globalmente</div>';
            } else {
                console.error('‚ùå updateHeatmap n√£o est√° definida globalmente');
                resultsDiv.innerHTML += '<div class="error">‚ùå updateHeatmap n√£o acess√≠vel</div>';
            }
        }

        function simulateGraphicsTab() {
            const resultsDiv = document.getElementById('simulationResults');
            resultsDiv.innerHTML = '<div>üîÑ Simulando clique na aba gr√°ficos...</div>';
            
            try {
                if (typeof window.switchTab === 'function') {
                    console.log('üéØ Chamando switchTab("charts")...');
                    window.switchTab('charts');
                    resultsDiv.innerHTML = '<div class="success">‚úÖ switchTab("charts") executada sem erros</div>';
                } else {
                    throw new Error('switchTab n√£o est√° definida');
                }
            } catch (error) {
                console.error('‚ùå Erro ao simular clique:', error);
                resultsDiv.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
            }
        }

        // Executar testes autom√°ticos ao carregar
        window.onload = function() {
            console.log('üöÄ Iniciando testes autom√°ticos...');
            setTimeout(testChartJS, 500);
            setTimeout(testSwitchTab, 1000);
            setTimeout(testLoadChartData, 1500);
            setTimeout(testUpdateHeatmap, 2000);
        };
    </script>
    
    <!-- Carregar Chart.js para teste -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</body>
</html>
