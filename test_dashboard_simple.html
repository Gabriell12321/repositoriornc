<!DOCTYPE html>
<html>
<head>
    <title>IPPEL RNC - Dashboard Teste Simplificado</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f0f0f0; }
        .tab-button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .tab-button.active { background: #28a745; }
        .container { background: white; padding: 20px; border-radius: 8px; margin: 10px 0; }
        .charts-container { display: none; }
        .charts-container.active { display: block; }
        canvas { width: 100%; height: 300px; }
    </style>
</head>
<body>
    <h1>IPPEL RNC System - Teste Simplificado</h1>
    
    <div class="container">
        <h2>Navegação</h2>
        <button class="tab-button active" onclick="switchTab('home')">🏠 Início</button>
        <button class="tab-button" onclick="switchTab('charts')">📊 Gráficos</button>
        <button class="tab-button" onclick="switchTab('indicadores')">📈 Indicadores</button>
    </div>

    <div id="homeContainer" class="container">
        <h2>🏠 Início</h2>
        <p>Bem-vindo ao sistema IPPEL RNC. Use os botões acima para navegar.</p>
        <button onclick="testFunctions()">🧪 Testar Funções</button>
        <div id="testResults"></div>
    </div>

    <div id="chartsContainer" class="container charts-container">
        <h2>📊 Gráficos</h2>
        <select id="chartPeriod" onchange="loadChartData()">
            <option value="30">Últimos 30 dias</option>
            <option value="90">Últimos 90 dias</option>
            <option value="all">Todos os dados</option>
        </select>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
            <div>
                <h3>Gráfico de Status</h3>
                <canvas id="statusChart"></canvas>
            </div>
            <div>
                <h3>Gráfico de Tendência</h3>
                <canvas id="trendChart"></canvas>
            </div>
        </div>
    </div>

    <div id="indicadoresContainer" class="container charts-container">
        <h2>📈 Indicadores</h2>
        <p>Indicadores serão exibidos aqui.</p>
    </div>

    <script>
        // Variáveis globais
        let charts = {};
        let currentTab = 'home';

        // FUNÇÃO PRINCIPAL: switchTab
        function switchTab(tab) {
            console.log(`🔄 Alternando para aba: ${tab}`);
            
            // Atualizar botões
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeButton = document.querySelector(`button[onclick="switchTab('${tab}')"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }

            // Mostrar/ocultar containers
            document.querySelectorAll('.charts-container').forEach(container => {
                container.style.display = 'none';
            });
            
            document.getElementById('homeContainer').style.display = 'none';

            currentTab = tab;

            if (tab === 'home') {
                document.getElementById('homeContainer').style.display = 'block';
            } else if (tab === 'charts') {
                document.getElementById('chartsContainer').style.display = 'block';
                console.log('📊 Carregando gráficos...');
                loadChartData();
            } else if (tab === 'indicadores') {
                document.getElementById('indicadoresContainer').style.display = 'block';
                console.log('📈 Carregando indicadores...');
            }
        }

        // FUNÇÃO: loadChartData  
        function loadChartData() {
            const period = document.getElementById('chartPeriod').value;
            console.log(`📊 Carregando dados para período: ${period}`);
            
            // Simulação de dados
            const simulatedData = {
                status: [
                    { label: 'Aberta', count: 25, color: '#ff6b6b' },
                    { label: 'Em Análise', count: 18, color: '#4ecdc4' },
                    { label: 'Finalizada', count: 42, color: '#96ceb4' }
                ],
                trend: [
                    { date: '2024-08-01', count: 5 },
                    { date: '2024-08-02', count: 8 },
                    { date: '2024-08-03', count: 3 },
                    { date: '2024-08-04', count: 12 },
                    { date: '2024-08-05', count: 7 }
                ]
            };

            createCharts(simulatedData);
        }

        // FUNÇÃO: createCharts
        function createCharts(data) {
            console.log('🎨 Criando gráficos...', data);

            // Destruir gráficos existentes
            Object.values(charts).forEach(chart => {
                if (chart && typeof chart.destroy === 'function') {
                    chart.destroy();
                }
            });
            charts = {};

            // Verificar se Chart.js está disponível
            if (typeof Chart === 'undefined') {
                console.error('❌ Chart.js não disponível!');
                return;
            }

            // Criar gráfico de status
            const statusCtx = document.getElementById('statusChart');
            if (statusCtx) {
                charts.status = new Chart(statusCtx, {
                    type: 'doughnut',
                    data: {
                        labels: data.status.map(s => s.label),
                        datasets: [{
                            data: data.status.map(s => s.count),
                            backgroundColor: data.status.map(s => s.color)
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
                console.log('✅ Gráfico de status criado');
            }

            // Criar gráfico de tendência
            const trendCtx = document.getElementById('trendChart');
            if (trendCtx) {
                charts.trend = new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: data.trend.map(t => t.date),
                        datasets: [{
                            label: 'RNCs por Dia',
                            data: data.trend.map(t => t.count),
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
                console.log('✅ Gráfico de tendência criado');
            }
        }

        // FUNÇÃO: testFunctions
        function testFunctions() {
            const resultsDiv = document.getElementById('testResults');
            let results = '<h3>🧪 Resultados dos Testes:</h3>';
            
            // Testar se funções estão disponíveis
            const functions = ['switchTab', 'loadChartData', 'createCharts'];
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    results += `<p style="color: green;">✅ ${funcName} está disponível globalmente</p>`;
                } else {
                    results += `<p style="color: red;">❌ ${funcName} NÃO está disponível globalmente</p>`;
                }
            });

            // Testar Chart.js
            if (typeof Chart !== 'undefined') {
                results += `<p style="color: green;">✅ Chart.js disponível (v${Chart.version})</p>`;
            } else {
                results += `<p style="color: red;">❌ Chart.js NÃO disponível</p>`;
            }

            resultsDiv.innerHTML = results;
        }

        // EXPOSIÇÃO GLOBAL DAS FUNÇÕES
        window.switchTab = switchTab;
        window.loadChartData = loadChartData;
        window.createCharts = createCharts;
        window.testFunctions = testFunctions;

        console.log('🚀 Sistema de teste carregado!');
        console.log('✅ Funções disponíveis:', Object.keys(window).filter(key => typeof window[key] === 'function' && ['switchTab', 'loadChartData', 'createCharts'].includes(key)));
    </script>
</body>
</html>
