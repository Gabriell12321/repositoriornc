<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RNC {{ rnc.rnc_number }}</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: 'Poppins','Inter', system-ui, sans-serif; 
            margin: 0;
            background: #f7f7fb; 
            color: #333; 
        }
        .container {
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 24px; 
        }
        .header {
            display:flex; 
            align-items:center; 
            justify-content:space-between; 
            margin-bottom: 20px; 
        }
        .logo {
            display:flex; 
            align-items:center; 
            gap:12px; 
        }
        .logo img {
            width:60px; 
            height:60px; 
            border-radius:12px; 
            object-fit:contain; 
            box-shadow:0 4px 14px rgba(0,0,0,.1); 
        }
        .title {
            font-weight:800; 
            letter-spacing:.5px; 
            font-size:18px; 
            color:#8b1538; 
        }
        .rnc-number {
            font-weight:700; 
            font-size:14px; 
            color:#495057; 
        }

        .actions {
            display:flex; 
            gap:10px; 
        }
        .btn {
            padding:10px 14px; 
            border:none; 
            border-radius:10px; 
            font-weight:600; 
            cursor:pointer; 
            color:#fff; 
            display:inline-flex; 
            align-items:center; 
            gap:8px; 
            box-shadow:0 8px 20px rgba(0,0,0,.12); 
        }
        .btn-secondary { background:#6c757d; }
        .btn-primary { background:#0d6efd; }
        .btn-info { background:#17a2b8; }
        .btn-warning { background:#ffc107; color:#333; }

        .card {
            background:#fff; 
            border-radius:14px; 
            box-shadow:0 10px 30px rgba(0,0,0,.08); 
            margin-bottom:16px; 
            overflow:hidden; 
            border:1px solid #eee; 
        }
        .card-header {
            background:#8b1538; 
            color:#fff; 
            padding:10px 14px; 
            font-weight:700; 
            font-size:12px; 
            letter-spacing:.4px; 
        }
        .card-body {
            padding:16px; 
        }

        .grid {
            display:grid; 
            gap:12px; 
        }
        .grid-2 {
            grid-template-columns: 1fr 1fr; 
        }
        .grid-3 {
            grid-template-columns: 1fr 1fr 1fr; 
        }

        .field {
            display:flex; 
            flex-direction:column; 
            gap:6px; 
        }
        .label {
            font-size:11px; 
            color:#8b1538; 
            font-weight:700; 
        }
        .value {
            padding:10px 12px; 
            border:2px solid #8b1538; 
            border-radius:8px; 
            background:#fff; 
            font-size:13px; 
            min-height:38px; 
            display:flex; 
            align-items:center; 
        }
        .muted {
            color:#6c757d; 
        }

        .dispo-grid {
            display:grid; 
            grid-template-columns: 1fr 1fr; 
        }
        .section-split {
            display:grid; 
            grid-template-columns: 1fr 1fr; 
            border:2px solid #8b1538; 
            border-top:none; 
            border-radius:0 0 10px 10px; 
        }
        .split-left {
            border-right:1px solid #8b1538; 
            padding:12px; 
        }
        .split-right {
            padding:12px; 
        }
        .checkbox {
            display:flex; 
            align-items:center; 
            gap:8px; 
            font-weight:600; 
            font-size:12px; 
            margin:6px 0; 
        }
        .checkbox input {
            width:16px; 
            height:16px; 
            accent-color:#8b1538; 
        }

        .sign-row {
            display:flex; 
            border-top:1px solid #8b1538; 
        }
        .sign-col {
            width:33.33%; 
            padding:14px; 
            text-align:center; 
            border-right:1px solid #8b1538; 
        }
        .sign-col:last-child {
            border-right:none; 
        }
        .sign-name {
            font-weight:700; 
            margin-bottom:18px; 
            min-height:20px; 
        }
        .sign-line {
            margin-top:8px; 
            padding-top:8px; 
            border-top:1px solid #dee2e6; 
            color:#6c757d; 
            font-weight:600; 
        }

        @media (max-width: 900px) {
            .grid-2 { grid-template-columns: 1fr; }
            .grid-3 { grid-template-columns: 1fr; }
            .section-split { grid-template-columns: 1fr; }
            .split-left { border-right:none; border-bottom:1px solid #8b1538; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo" style="gap:12px;">
                <img src="{{ url_for('static', filename='LOGOSQI.jpg') }}" alt="SQI Logo">
                <img src="/IPPELLOGO.jpg" alt="IPPEL Logo" class="apply-logo"
                     data-logo-primary="/IPPELLOGO.jpg"
                     data-logo-fallback1="/IPPELLOGO.jpg"
                     data-logo-fallback2="{{ url_for('static', filename='LOGOSQI.jpg') }}"
                     onerror="if(this.dataset.try1!=='1'){this.dataset.try1='1'; this.src=this.dataset.logoFallback1;} else if(this.dataset.try2!=='1'){this.dataset.try2='1'; this.src=this.dataset.logoFallback2;} else {this.style.display='none';}">
                <div>
                    <div class="title">Relat√≥rio de N√£o Conformidades Internas ‚Äì RNC</div>
                    <div class="rnc-number">N¬∫: {{ rnc.rnc_number }}</div>
            </div>
            </div>
            <div class="actions">
                <button class="btn btn-secondary" onclick="window.location.href='/dashboard'">‚Üê Voltar</button>
                <!-- Bot√£o de Resposta Obrigat√≥ria -->
                <button class="btn btn-warning" id="responseButton" onclick="openResponseModal()" style="display: none;">
                    ‚ö†Ô∏è Resposta Obrigat√≥ria
                </button>
                <button class="btn btn-info" onclick="window.location.href='/rnc/{{ rnc.id }}/reply'">‚Ü©Ô∏è Responder</button>
                <button class="btn btn-primary" onclick="window.location.href='/rnc/{{ rnc.id }}/edit'">‚úèÔ∏è Editar</button>
                <button class="btn btn-warning" onclick="window.open('/rnc/{{ rnc.id }}/print','_blank')">üìÑ Modelo IPPEL</button>
            </div>
        </div>

        <!-- Informa√ß√µes principais -->
        <div class="card">
            <div class="card-header">INFORMA√á√ïES</div>
            <div class="card-body grid grid-3">
                <div class="field">
                    <div class="label">üìã T√≠tulo</div>
                    <div class="value">{{ rnc.title or 'Sem t√≠tulo' }}</div>
                </div>
                <div class="field">
                    <div class="label">üîß Equipamento</div>
                    <div class="value">
                        {% if rnc.equipment %}
                            {{ rnc.equipment }}
                        {% else %}
                            <span style="color: #6c757d; font-style: italic;">N√£o especificado</span>
                        {% endif %}
                </div>
            </div>
                <div class="field">
                    <div class="label">üè¢ Cliente</div>
                    <div class="value">
                        {% if rnc.client %}
                            {{ rnc.client }}
                        {% else %}
                            <span style="color: #6c757d; font-style: italic;">N√£o especificado</span>
                        {% endif %}
                </div>
                </div>
                <div class="field">
                    <div class="label">üí∞ Pre√ßo (R$)</div>
                    <div class="value">
                        {% if rnc.price and rnc.price > 0 %}
                            R$ {{ "{:,.2f}".format(rnc.price|float).replace(',', 'X').replace('.', ',').replace('X', '.') if rnc.price else '0,00' }}
                        {% else %}
                            <span style="color: #6c757d; font-style: italic;">N√£o informado</span>
                        {% endif %}
                </div>
            </div>
                <div class="field">
                    <div class="label">‚ö° Prioridade</div>
                    <div class="value">
                        {% if rnc.priority == 'Cr√≠tica' %}
                            <span style="color: #dc3545; font-weight: bold;">{{ rnc.priority }}</span>
                        {% elif rnc.priority == 'Alta' %}
                            <span style="color: #fd7e14; font-weight: bold;">{{ rnc.priority }}</span>
                        {% elif rnc.priority == 'M√©dia' %}
                            <span style="color: #ffc107; font-weight: bold;">{{ rnc.priority }}</span>
                        {% elif rnc.priority == 'Baixa' %}
                            <span style="color: #28a745; font-weight: bold;">{{ rnc.priority }}</span>
                        {% else %}
                            {{ rnc.priority or 'M√©dia' }}
                        {% endif %}
            </div>
                </div>
                <div class="field">
                    <div class="label">üìä Status Atual</div>
                    <div class="value">
                        {% if rnc.status == 'Finalizado' %}
                            <span style="color: #28a745; font-weight: bold;">‚úÖ {{ rnc.status }}</span>
                        {% elif rnc.status == 'Pendente' %}
                            <span style="color: #ffc107; font-weight: bold;">‚è≥ {{ rnc.status }}</span>
                        {% elif rnc.status == 'Em andamento' %}
                            <span style="color: #17a2b8; font-weight: bold;">üîÑ {{ rnc.status }}</span>
                        {% else %}
                            {{ rnc.status or 'Pendente' }}
                {% endif %}
                    </div>
                </div>
                <div class="field">
                    <div class="label">üë§ Respons√°vel</div>
                    <div class="value">{{ rnc.user_name or 'N√£o definido' }}</div>
                </div>
                {% if rnc.department %}
                <div class="field">
                    <div class="label">üè¢ Departamento</div>
                    <div class="value">{{ rnc.department }}</div>
                </div>
                {% endif %}
                {% if rnc.created_at %}
                <div class="field">
                    <div class="label">üìÖ Data de Cria√ß√£o</div>
                    <div class="value">{{ rnc.created_at[:10] if rnc.created_at else 'N/A' }}</div>
            </div>
            {% endif %}
            </div>
        </div>

        <!-- Descri√ß√£o -->
        <div class="card">
            <div class="card-header">DESCRI√á√ÉO DA N√ÉO CONFORMIDADE</div>
            <div class="card-body">
                <!-- Informa√ß√µes t√©cnicas organizadas -->
                {% if txt_fields %}
                    {% if txt_fields.get('Desenho') or txt_fields.get('DESENHO') or txt_fields.get('MP') or txt_fields.get('mp') %}
                    <div class="grid grid-3" style="margin-bottom: 20px;">
                        {% if txt_fields.get('Desenho') or txt_fields.get('DESENHO') %}
                        <div class="field">
                            <div class="label">üìê Desenho</div>
                            <div class="value">{{ txt_fields.get('Desenho') or txt_fields.get('DESENHO') or '-' }}</div>
                </div>
                {% endif %}
                        {% if txt_fields.get('MP') or txt_fields.get('mp') %}
                        <div class="field">
                            <div class="label">üîß MP</div>
                            <div class="value">{{ txt_fields.get('MP') or txt_fields.get('mp') or '-' }}</div>
                </div>
                {% endif %}
                        {% if txt_fields.get('Revis√£o') or txt_fields.get('REVISAO') or txt_fields.get('REV') %}
                        <div class="field">
                            <div class="label">üìù Revis√£o</div>
                            <div class="value">{{ txt_fields.get('Revis√£o') or txt_fields.get('REVISAO') or txt_fields.get('REV') or '-' }}</div>
                </div>
                {% endif %}
            </div>
            {% endif %}
                    
                    {% if txt_fields.get('CV') or txt_fields.get('cv') or txt_fields.get('POS') or txt_fields.get('Pos') %}
                    <div class="grid grid-3" style="margin-bottom: 20px;">
                        {% if txt_fields.get('CV') or txt_fields.get('cv') %}
                        <div class="field">
                            <div class="label">üìä CV</div>
                            <div class="value">{{ txt_fields.get('CV') or txt_fields.get('cv') or '-' }}</div>
                </div>
                {% endif %}
                        {% if txt_fields.get('POS') or txt_fields.get('Pos') %}
                        <div class="field">
                            <div class="label">üìç POS</div>
                            <div class="value">{{ txt_fields.get('POS') or txt_fields.get('Pos') or '-' }}</div>
                </div>
                {% endif %}
                        {% if txt_fields.get('Conjunto') or txt_fields.get('CONJUNTO') %}
                        <div class="field">
                            <div class="label">üîó Conjunto</div>
                            <div class="value">{{ txt_fields.get('Conjunto') or txt_fields.get('CONJUNTO') or '-' }}</div>
                </div>
                {% endif %}
            </div>
                    {% endif %}
                    
                    {% if txt_fields.get('Modelo') or txt_fields.get('MODELO') or txt_fields.get('Quantidade') or txt_fields.get('QUANTIDADE') %}
                    <div class="grid grid-3" style="margin-bottom: 20px;">
                        {% if txt_fields.get('Modelo') or txt_fields.get('MODELO') %}
                        <div class="field">
                            <div class="label">üè∑Ô∏è Modelo</div>
                            <div class="value">{{ txt_fields.get('Modelo') or txt_fields.get('MODELO') or '-' }}</div>
                </div>
                        {% endif %}
                        {% if txt_fields.get('Quantidade') or txt_fields.get('QUANTIDADE') %}
                        <div class="field">
                            <div class="label">üî¢ Quantidade</div>
                            <div class="value">{{ txt_fields.get('Quantidade') or txt_fields.get('QUANTIDADE') or '-' }}</div>
                </div>
                        {% endif %}
                        {% if txt_fields.get('√Årea respons√°vel') or txt_fields.get('AREA RESPONSAVEL') or txt_fields.get('Area responsavel') %}
                        <div class="field">
                            <div class="label">üë• √Årea Respons√°vel</div>
                            <div class="value">{{ txt_fields.get('√Årea respons√°vel') or txt_fields.get('AREA RESPONSAVEL') or txt_fields.get('Area responsavel') or '-' }}</div>
            </div>
                        {% endif %}
        </div>
                    {% endif %}
                {% endif %}
                
                <!-- Instru√ß√£o para retrabalho -->
                {% if txt_fields.get('Instru√ß√£o para retrabalho') or txt_fields.get('INSTRU√á√ÉO PARA RETRABALHO') or txt_fields.get('Instrucao para retrabalho') or txt_fields.get('INSTRUCAO PARA RETRABALHO') %}
                <div class="field" style="margin-top: 20px;">
                    <div class="label">‚öôÔ∏è Instru√ß√£o para Retrabalho</div>
                    <div class="value" style="min-height: 60px; white-space: pre-wrap;">{{ txt_fields.get('Instru√ß√£o para retrabalho') or txt_fields.get('INSTRU√á√ÉO PARA RETRABALHO') or txt_fields.get('Instrucao para retrabalho') or txt_fields.get('INSTRUCAO PARA RETRABALHO') or '-' }}</div>
                </div>
                {% endif %}
                
                <!-- Valor -->
                {% if txt_fields.get('Valor') or txt_fields.get('VALOR') %}
                <div class="field" style="margin-top: 20px;">
                    <div class="label">üí∞ Valor</div>
                    <div class="value">{{ txt_fields.get('Valor') or txt_fields.get('VALOR') or '-' }}</div>
            </div>
                {% endif %}
                
                <!-- Descri√ß√£o da RNC -->
                {% if txt_fields.get('Descri√ß√£o da RNC') or txt_fields.get('DESCRI√á√ÉO DA RNC') or txt_fields.get('Descricao da RNC') or txt_fields.get('DESCRICAO DA RNC') %}
                <div class="field" style="margin-top: 20px;">
                    <div class="label">üìã Descri√ß√£o da RNC</div>
                    <div class="value" style="min-height: 60px; white-space: pre-wrap;">{{ txt_fields.get('Descri√ß√£o da RNC') or txt_fields.get('DESCRI√á√ÉO DA RNC') or txt_fields.get('Descricao da RNC') or txt_fields.get('DESCRICAO DA RNC') }}</div>
                        </div>
                {% elif rnc.description %}
                <div class="field" style="margin-top: 20px;">
                    <div class="label">üìÑ Descri√ß√£o</div>
                    <div class="value" style="min-height: 60px; white-space: pre-wrap;">{{ rnc.description }}</div>
                        </div>
                {% else %}
                <div class="field" style="margin-top: 20px;">
                    <div class="label">üìÑ Descri√ß√£o</div>
                    <div class="value" style="min-height: 60px; white-space: pre-wrap; color: #6c757d; font-style: italic;">
                        üìù Descri√ß√£o da n√£o conformidade a ser preenchida
                        </div>
                        </div>
                {% endif %}
                        </div>
        </div>

        <!-- Instru√ß√£o para Retrabalho -->
        <div class="card">
            <div class="card-header">‚öôÔ∏è INSTRU√á√ÉO PARA RETRABALHO</div>
            <div class="card-body">
                <div class="value" style="min-height:60px; white-space: pre-wrap;">
                    {% if txt_fields.get('Instru√ß√£o para retrabalho') or txt_fields.get('INSTRU√á√ÉO PARA RETRABALHO') or txt_fields.get('Instrucao para retrabalho') or txt_fields.get('INSTRUCAO PARA RETRABALHO') %}
                        {{ txt_fields.get('Instru√ß√£o para retrabalho') or txt_fields.get('INSTRU√á√ÉO PARA RETRABALHO') or txt_fields.get('Instrucao para retrabalho') or txt_fields.get('INSTRUCAO PARA RETRABALHO') }}
                    {% elif rnc.instruction_retrabalho and rnc.instruction_retrabalho != 'Aguardando instru√ß√µes de retrabalho' %}
                        {{ rnc.instruction_retrabalho }}
                    {% else %}
                        <span style="color: #6c757d; font-style: italic;">üìù Aguardando instru√ß√µes de retrabalho</span>
                    {% endif %}
                        </div>
                    </div>
                </div>
                
        <!-- Causa da RNC -->
        <div class="card" id="causeSection">
            <div class="card-header" style="background: {% if not rnc.cause_rnc or rnc.cause_rnc == 'Causa a ser investigada' %}#ffc107{% else %}#8b1538{% endif %}; color: {% if not rnc.cause_rnc or rnc.cause_rnc == 'Causa a ser investigada' %}#333{% else %}#fff{% endif %};">
                üîç CAUSA DA RNC 
                {% if not rnc.cause_rnc or rnc.cause_rnc == 'Causa a ser investigada' %}
                    <span style="float: right; font-size: 10px; background: #dc3545; color: white; padding: 2px 6px; border-radius: 4px;">OBRIGAT√ìRIO</span>
                {% endif %}
            </div>
            <div class="card-body" style="{% if not rnc.cause_rnc or rnc.cause_rnc == 'Causa a ser investigada' %}border: 3px solid #ffc107;{% endif %}">
                <div class="value" style="min-height:60px; white-space: pre-wrap;">
                    {% if txt_fields.get('Causa da RNC') or txt_fields.get('CAUSA DA RNC') or txt_fields.get('Causa da rnc') or txt_fields.get('causa da rnc') %}
                        {{ txt_fields.get('Causa da RNC') or txt_fields.get('CAUSA DA RNC') or txt_fields.get('Causa da rnc') or txt_fields.get('causa da rnc') }}
                    {% elif rnc.cause_rnc and rnc.cause_rnc != 'Causa a ser investigada' %}
                        {{ rnc.cause_rnc }}
                    {% else %}
                        <span style="color: #ffc107; font-style: italic; font-weight: bold;">‚ö†Ô∏è Resposta obrigat√≥ria pendente - Causa a ser investigada</span>
                    {% endif %}
                        </div>
                        </div>
                        </div>

        <!-- A√ß√£o a ser Tomada -->
        <div class="card" id="actionSection">
            <div class="card-header" style="background: {% if not rnc.action_rnc or rnc.action_rnc == 'A√ß√µes a serem definidas' %}#ffc107{% else %}#8b1538{% endif %}; color: {% if not rnc.action_rnc or rnc.action_rnc == 'A√ß√µes a serem definidas' %}#333{% else %}#fff{% endif %};">
                ‚úÖ A√á√ÉO A SER TOMADA 
                {% if not rnc.action_rnc or rnc.action_rnc == 'A√ß√µes a serem definidas' %}
                    <span style="float: right; font-size: 10px; background: #dc3545; color: white; padding: 2px 6px; border-radius: 4px;">OBRIGAT√ìRIO</span>
                {% endif %}
            </div>
            <div class="card-body" style="{% if not rnc.action_rnc or rnc.action_rnc == 'A√ß√µes a serem definidas' %}border: 3px solid #ffc107;{% endif %}">
                <div class="value" style="min-height:60px; white-space: pre-wrap;">
                    {% if txt_fields.get('A√ß√£o a ser tomada') or txt_fields.get('A√á√ÉO A SER TOMADA') or txt_fields.get('Acao a ser tomada') or txt_fields.get('ACAO A SER TOMADA') %}
                        {{ txt_fields.get('A√ß√£o a ser tomada') or txt_fields.get('A√á√ÉO A SER TOMADA') or txt_fields.get('Acao a ser tomada') or txt_fields.get('ACAO A SER TOMADA') }}
                    {% elif rnc.action_rnc and rnc.action_rnc != 'A√ß√µes a serem definidas' %}
                        {{ rnc.action_rnc }}
                    {% else %}
                        <span style="color: #ffc107; font-style: italic; font-weight: bold;">‚ö†Ô∏è Resposta obrigat√≥ria pendente - A√ß√µes a serem definidas</span>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Disposi√ß√£o e Inspe√ß√£o -->
        <div class="card">
            <div class="card-header" style="display:flex; justify-content:space-between;">
                <div>DISPOSI√á√ÉO DO MATERIAL N√ÉO-CONFORME</div>
                <div>INSPE√á√ÉO DO RETRABALHO</div>
                </div>
            <div class="section-split">
                <div class="split-left">
                    <div class="checkbox">
                        <input type="checkbox" disabled {% if rnc.disposition_usar %}checked{% endif %}> 
                        <span style="{% if rnc.disposition_usar %}color: #28a745; font-weight: bold;{% endif %}">USAR COMO EST√Å</span>
                </div>
                    <div class="checkbox">
                        <input type="checkbox" disabled {% if rnc.disposition_retrabalhar %}checked{% endif %}> 
                        <span style="{% if rnc.disposition_retrabalhar %}color: #17a2b8; font-weight: bold;{% endif %}">RETRABALHAR</span>
                </div>
                    <div class="checkbox">
                        <input type="checkbox" disabled {% if rnc.disposition_rejeitar %}checked{% endif %}> 
                        <span style="{% if rnc.disposition_rejeitar %}color: #dc3545; font-weight: bold;{% endif %}">REJEITAR</span>
            </div>
                    <div class="checkbox">
                        <input type="checkbox" disabled {% if rnc.disposition_sucata %}checked{% endif %}> 
                        <span style="color: #6c757d; font-weight: bold;">SUCATA</span>
                </div>
                    <div class="checkbox">
                        <input type="checkbox" disabled {% if rnc.disposition_devolver_estoque %}checked{% endif %}> 
                        <span style="color: #fd7e14; font-weight: bold;">DEVOLVER AO ESTOQUE</span>
                </div>
                    <div class="checkbox">
                        <input type="checkbox" disabled {% if rnc.disposition_devolver_fornecedor %}checked{% endif %}> 
                        <span style="color: #6f42c1; font-weight: bold;">DEVOLVER AO FORNECEDOR</span>
                </div>
            </div>
                <div class="split-right">
                    <div class="checkbox">
                        <input type="checkbox" disabled {% if rnc.inspection_aprovado %}checked{% endif %}> 
                        <span style="{% if rnc.inspection_aprovado %}color: #28a745; font-weight: bold;{% endif %}">APROVADO</span>
                </div>
                    <div class="checkbox">
                        <input type="checkbox" disabled {% if rnc.inspection_reprovado %}checked{% endif %}> 
                        <span style="{% if rnc.inspection_reprovado %}color: #dc3545; font-weight: bold;{% endif %}">REPROVADO</span>
                </div>
                    <div class="checkbox" style="gap:12px;">
                        <div style="display:flex; align-items:center; gap:8px;">
                            <input type="checkbox" disabled {% if rnc.inspection_ver_rnc %}checked{% endif %}> 
                            <span style="{% if rnc.inspection_ver_rnc %}color: #ffc107; font-weight: bold;{% endif %}">VER RNC N¬∫:</span>
                            <div class="value" style="border:none; padding:0; min-height:auto;">
                                {% if rnc.inspection_ver_rnc %}
                                    {{ rnc.inspection_ver_rnc }}
                                {% else %}
                                    <span style="color: #6c757d; font-style: italic;">N/A</span>
                                {% endif %}
                </div>
            </div>
            </div>
        </div>
            </div>
    </div>

        <!-- Assinaturas -->
        <div class="card">
            <div class="card-header">ASSINATURAS</div>
            <div class="card-body" style="padding:0; border:2px solid #8b1538; border-radius:8px; overflow:hidden;">
                <div class="sign-row" style="border-bottom:1px solid #8b1538;">
                    <div class="sign-col" style="font-size:11px; font-weight:bold;">
                        INSPE√á√ÉO: {{ rnc.signature_inspection_date or 'Aguardando' }}
            </div>
                    <div class="sign-col" style="font-size:11px; font-weight:bold;">
                        ENGENHARIA: {{ rnc.signature_engineering_date or 'Aguardando' }}
                </div>
                    <div class="sign-col" style="font-size:11px; font-weight:bold;">
                        INSPE√á√ÉO 2: {{ rnc.signature_inspection2_date or 'Aguardando' }}
                </div>
                </div>
                <div class="sign-row">
                    <div class="sign-col">
                        <div class="sign-name">
                            {% if rnc.signature_inspection_name and rnc.signature_inspection_name != 'NOME' %}
                                {{ rnc.signature_inspection_name }}
                            {% else %}
                                <span style="color: #6c757d; font-style: italic;">Aguardando assinatura</span>
                            {% endif %}
            </div>
                        <div class="sign-line">VISTO</div>
            </div>
                    <div class="sign-col">
                        <div class="sign-name">
                            {% if rnc.signature_engineering_name and rnc.signature_engineering_name != 'NOME' %}
                                {{ rnc.signature_engineering_name }}
                            {% else %}
                                <span style="color: #6c757d; font-style: italic;">Aguardando assinatura</span>
                            {% endif %}
        </div>
                        <div class="sign-line">VISTO</div>
    </div>
                    <div class="sign-col">
                        <div class="sign-name">
                            {% if rnc.signature_inspection2_name and rnc.signature_inspection2_name != 'NOME' %}
                                {{ rnc.signature_inspection2_name }}
                            {% else %}
                                <span style="color: #6c757d; font-style: italic;">Aguardando assinatura</span>
                            {% endif %}
                        </div>
                        <div class="sign-line">VISTO</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Resposta Obrigat√≥ria -->
    <div id="responseModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 600px; max-height: 80%; overflow-y: auto;">
            <h3 style="color: #8b1538; margin-bottom: 20px;">‚ö†Ô∏è Resposta Obrigat√≥ria Necess√°ria</h3>
            
            <div id="responseContent">
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <strong>üìã Campos obrigat√≥rios a preencher:</strong>
                    <ul id="missingFields" style="margin: 10px 0; padding-left: 20px;">
                        <!-- Ser√° preenchido dinamicamente -->
                    </ul>
                </div>

                <form id="responseForm">
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: bold; color: #8b1538; margin-bottom: 8px;">
                            üîç Causa da RNC <span style="color: red;">*</span>
                        </label>
                        <textarea 
                            id="cause_rnc" 
                            name="cause_rnc" 
                            style="width: 100%; min-height: 100px; padding: 10px; border: 2px solid #8b1538; border-radius: 8px; font-size: 14px;"
                            placeholder="Descreva a causa raiz da n√£o conformidade..."
                            required
                        ></textarea>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: bold; color: #8b1538; margin-bottom: 8px;">
                            ‚úÖ A√ß√£o a ser Tomada <span style="color: red;">*</span>
                        </label>
                        <textarea 
                            id="action_rnc" 
                            name="action_rnc" 
                            style="width: 100%; min-height: 100px; padding: 10px; border: 2px solid #8b1538; border-radius: 8px; font-size: 14px;"
                            placeholder="Descreva as a√ß√µes corretivas a serem implementadas..."
                            required
                        ></textarea>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" onclick="closeResponseModal()" class="btn btn-secondary">
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            üíæ Salvar Resposta
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Verificar status de resposta ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            checkResponseStatus();
        });

        async function checkResponseStatus() {
            try {
                const response = await fetch(`/api/rnc/{{ rnc.id }}/response-status`);
                const data = await response.json();
                
                if (data.success && data.needs_response) {
                    const btn = document.getElementById('responseButton');
                    btn.style.display = 'block';
                    
                    // Atualizar lista de campos obrigat√≥rios
                    const missingFields = document.getElementById('missingFields');
                    missingFields.innerHTML = '';
                    
                    if (data.missing_fields) {
                        data.missing_fields.forEach(field => {
                            const li = document.createElement('li');
                            if (field === 'cause_rnc') {
                                li.textContent = 'üîç Causa da RNC';
                            } else if (field === 'action_rnc') {
                                li.textContent = '‚úÖ A√ß√£o a ser Tomada';
                            } else {
                                li.textContent = field;
                            }
                            missingFields.appendChild(li);
                        });
                    }
                }
            } catch (error) {
                console.error('Erro ao verificar status de resposta:', error);
            }
        }

        function openResponseModal() {
            document.getElementById('responseModal').style.display = 'flex';
        }

        function closeResponseModal() {
            document.getElementById('responseModal').style.display = 'none';
        }

        // Submiss√£o do formul√°rio de resposta
        document.getElementById('responseForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {
                cause_rnc: formData.get('cause_rnc'),
                action_rnc: formData.get('action_rnc')
            };

            try {
                const response = await fetch(`/api/rnc/{{ rnc.id }}/respond`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ Resposta salva com sucesso!');
                    closeResponseModal();
                    // Recarregar a p√°gina para mostrar as atualiza√ß√µes
                    window.location.reload();
                } else {
                    alert('‚ùå Erro ao salvar resposta: ' + (result.message || 'Erro desconhecido'));
                }
            } catch (error) {
                console.error('Erro ao enviar resposta:', error);
                alert('‚ùå Erro ao salvar resposta. Tente novamente.');
            }
        });

        // Fechar modal clicando fora dele
        document.getElementById('responseModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeResponseModal();
            }
        });
    </script>
</body>
</html> 