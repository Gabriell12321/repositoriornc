<!DOCTYPE html>
<html>
<head>
    <title>IPPEL - Sistema de RNC - Dashboard Avançado</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Chart.js com plugins avançados -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    
    <!-- Bibliotecas para funcionalidades avançadas -->
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .main-container {
            display: flex;
            height: 100vh;
            min-height: 100vh;
        }
        
        .left-section {
            flex: 1;
            padding: 20px;
            background: white;
            overflow-y: auto;
            overflow-x: hidden;
            min-width: 0;
            border-radius: 0 20px 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .right-section {
            width: 350px;
            min-width: 350px;
            background: #f8f9fa;
            border-left: 1px solid #dee2e6;
            padding: 20px;
            overflow-y: auto;
            border-radius: 20px 0 0 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo img {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            object-fit: contain;
        }
        
        .logo h1 {
            color: #007bff;
            font-size: 24px;
            font-weight: 700;
        }
        
        /* Sistema de Abas Melhorado */
        .tabs-container {
            margin-bottom: 30px;
        }
        
        .tabs-header {
            display: flex;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .tab-button {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: transparent;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            z-index: 2;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            box-shadow: 0 8px 25px rgba(0,123,255,0.4);
            transform: translateY(-2px);
        }
        
        .tab-button:hover:not(.active) {
            background: #e9ecef;
            transform: translateY(-1px);
        }
        
        /* Dashboard de Gráficos Avançado */
        .charts-dashboard {
            margin-top: 20px;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #fff, #f8f9fa);
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .dashboard-title {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #333;
            font-size: 22px;
            font-weight: 700;
        }
        
        .dashboard-controls {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 8px 12px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .control-group label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
        }
        
        .control-group select, .control-group input {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            min-width: 120px;
        }
        
        .action-button {
            padding: 10px 16px;
            border: none;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary { background: linear-gradient(135deg, #007bff, #0056b3); color: white; }
        .btn-success { background: linear-gradient(135deg, #28a745, #1e7e34); color: white; }
        .btn-info { background: linear-gradient(135deg, #17a2b8, #138496); color: white; }
        .btn-warning { background: linear-gradient(135deg, #ffc107, #e0a800); color: #333; }
        
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        /* Grid de Gráficos Responsivo */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .chart-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #007bff, #28a745, #ffc107, #dc3545);
        }
        
        .chart-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-options {
            display: flex;
            gap: 8px;
        }
        
        .chart-option-btn {
            padding: 6px 10px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .chart-option-btn:hover {
            background: #f8f9fa;
            border-color: #007bff;
        }
        
        .chart-option-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .chart-container {
            position: relative;
            height: 350px;
            margin-bottom: 15px;
        }
        
        .chart-container canvas {
            width: 100% !important;
            height: 100% !important;
        }
        
        .chart-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #007bff;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Gráficos Especiais */
        .chart-card.full-width {
            grid-column: 1 / -1;
        }
        
        .chart-card.half-height .chart-container {
            height: 200px;
        }
        
        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi-card {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }
        
        .kpi-card.primary::before { background: #007bff; }
        .kpi-card.success::before { background: #28a745; }
        .kpi-card.warning::before { background: #ffc107; }
        .kpi-card.danger::before { background: #dc3545; }
        .kpi-card.info::before { background: #17a2b8; }
        
        .kpi-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .kpi-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .kpi-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .kpi-label {
            font-size: 14px;
            color: #666;
            font-weight: 600;
        }
        
        .kpi-trend {
            font-size: 12px;
            margin-top: 8px;
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-block;
        }
        
        .trend-up { background: #d4edda; color: #155724; }
        .trend-down { background: #f8d7da; color: #721c24; }
        .trend-stable { background: #fff3cd; color: #856404; }
        
        /* Modal para Drill-down */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 20px;
            width: 95%;
            max-width: 1200px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            padding: 20px 25px;
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            margin: 0;
        }
        
        .close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 25px;
            max-height: calc(90vh - 140px);
            overflow-y: auto;
        }
        
        /* Responsividade */
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
                height: auto;
            }
            
            .right-section {
                width: 100%;
                min-width: auto;
                border-radius: 0;
            }
            
            .left-section {
                border-radius: 0;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .dashboard-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Loading States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: #666;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Tooltips customizados */
        .custom-tooltip {
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="left-section">
            <div class="header">
                <div class="logo">
                    <img src="/LOGOSQI.jpg" alt="IPPEL Logo">
                    <h1>Sistema RNC</h1>
                </div>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-details">
                        <h3 id="userName">Carregando...</h3>
                        <p id="userDepartment">Departamento</p>
                    </div>
                </div>
            </div>
            
            <!-- Sistema de Abas -->
            <div class="tabs-container">
                <div class="tabs-header">
                    <button class="tab-button active" onclick="switchTab('dashboard')">
                        📊 Dashboard Avançado
                    </button>
                    <button class="tab-button" onclick="switchTab('analytics')">
                        📈 Analytics
                    </button>
                    <button class="tab-button" onclick="switchTab('reports')">
                        📋 Relatórios
                    </button>
                </div>
            </div>
            
            <!-- Dashboard Principal -->
            <div id="dashboardTab" class="tab-content">
                <!-- KPIs -->
                <div class="kpi-grid">
                    <div class="kpi-card primary">
                        <div class="kpi-icon">📊</div>
                        <div class="kpi-value" id="totalRncs">0</div>
                        <div class="kpi-label">Total RNCs</div>
                        <div class="kpi-trend trend-up" id="totalTrend">+5% vs mês anterior</div>
                    </div>
                    <div class="kpi-card warning">
                        <div class="kpi-icon">⏳</div>
                        <div class="kpi-value" id="pendingRncs">0</div>
                        <div class="kpi-label">Pendentes</div>
                        <div class="kpi-trend trend-down" id="pendingTrend">-2% vs mês anterior</div>
                    </div>
                    <div class="kpi-card success">
                        <div class="kpi-icon">✅</div>
                        <div class="kpi-value" id="resolvedRncs">0</div>
                        <div class="kpi-label">Resolvidos</div>
                        <div class="kpi-trend trend-up" id="resolvedTrend">+12% vs mês anterior</div>
                    </div>
                    <div class="kpi-card danger">
                        <div class="kpi-icon">🚨</div>
                        <div class="kpi-value" id="criticalRncs">0</div>
                        <div class="kpi-label">Críticos</div>
                        <div class="kpi-trend trend-stable" id="criticalTrend">Estável</div>
                    </div>
                    <div class="kpi-card info">
                        <div class="kpi-icon">⚡</div>
                        <div class="kpi-value" id="avgResolutionTime">0</div>
                        <div class="kpi-label">Tempo Médio (dias)</div>
                        <div class="kpi-trend trend-down" id="timeTrend">-1.5 dias vs mês anterior</div>
                    </div>
                </div>
                
                <!-- Dashboard de Gráficos -->
                <div class="charts-dashboard">
                    <div class="dashboard-header">
                        <div class="dashboard-title">
                            📊 Análise Avançada de Dados
                        </div>
                        <div class="dashboard-controls">
                            <div class="control-group">
                                <label>Período:</label>
                                <select id="chartPeriod" onchange="loadChartData()">
                                    <option value="7">Últimos 7 dias</option>
                                    <option value="30" selected>Últimos 30 dias</option>
                                    <option value="90">Últimos 90 dias</option>
                                    <option value="180">Últimos 6 meses</option>
                                    <option value="365">Último ano</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>Filtro:</label>
                                <select id="chartFilter" onchange="applyChartFilter()">
                                    <option value="all">Todos</option>
                                    <option value="critical">Apenas Críticos</option>
                                    <option value="pending">Apenas Pendentes</option>
                                    <option value="resolved">Apenas Resolvidos</option>
                                </select>
                            </div>
                            <button class="action-button btn-primary" onclick="refreshAllCharts()">
                                🔄 Atualizar
                            </button>
                            <button class="action-button btn-success" onclick="exportDashboard()">
                                📄 Exportar PDF
                            </button>
                            <button class="action-button btn-info" onclick="toggleFullscreen()">
                                🔍 Tela Cheia
                            </button>
                        </div>
                    </div>
                    
                    <!-- Grid de Gráficos -->
                    <div class="charts-grid">
                        <!-- Gráfico de Tendência Temporal -->
                        <div class="chart-card full-width">
                            <div class="chart-header">
                                <div class="chart-title">
                                    📈 Tendência Temporal de RNCs
                                </div>
                                <div class="chart-options">
                                    <button class="chart-option-btn active" onclick="changeChartType('trendChart', 'line')">Linha</button>
                                    <button class="chart-option-btn" onclick="changeChartType('trendChart', 'bar')">Barras</button>
                                    <button class="chart-option-btn" onclick="changeChartType('trendChart', 'area')">Área</button>
                                    <button class="chart-option-btn" onclick="drillDown('trend')">🔍 Detalhar</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="trendChart"></canvas>
                            </div>
                            <div class="chart-stats">
                                <div class="stat-item">
                                    <div class="stat-value" id="trendTotal">0</div>
                                    <div class="stat-label">Total</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="trendAvg">0</div>
                                    <div class="stat-label">Média/Dia</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="trendPeak">0</div>
                                    <div class="stat-label">Pico</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="trendGrowth">0%</div>
                                    <div class="stat-label">Crescimento</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Gráfico de Status -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <div class="chart-title">
                                    🎯 Distribuição por Status
                                </div>
                                <div class="chart-options">
                                    <button class="chart-option-btn active" onclick="changeChartType('statusChart', 'doughnut')">Rosca</button>
                                    <button class="chart-option-btn" onclick="changeChartType('statusChart', 'pie')">Pizza</button>
                                    <button class="chart-option-btn" onclick="changeChartType('statusChart', 'polarArea')">Polar</button>
                                    <button class="chart-option-btn" onclick="drillDown('status')">🔍</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="statusChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Gráfico de Prioridades -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <div class="chart-title">
                                    🚨 Distribuição por Prioridade
                                </div>
                                <div class="chart-options">
                                    <button class="chart-option-btn active" onclick="changeChartType('priorityChart', 'bar')">Barras</button>
                                    <button class="chart-option-btn" onclick="changeChartType('priorityChart', 'horizontalBar')">H-Barras</button>
                                    <button class="chart-option-btn" onclick="drillDown('priority')">🔍</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="priorityChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Heatmap de Departamentos vs Tempo -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <div class="chart-title">
                                    🔥 Heatmap: Departamentos vs Tempo
                                </div>
                                <div class="chart-options">
                                    <button class="chart-option-btn active" onclick="toggleHeatmapView('week')">Semana</button>
                                    <button class="chart-option-btn" onclick="toggleHeatmapView('month')">Mês</button>
                                    <button class="chart-option-btn" onclick="drillDown('heatmap')">🔍</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="heatmapChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Gráfico de Performance (Gauge) -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <div class="chart-title">
                                    ⚡ Performance de Resolução
                                </div>
                                <div class="chart-options">
                                    <button class="chart-option-btn active" onclick="updateGaugeMetric('resolution')">Resolução</button>
                                    <button class="chart-option-btn" onclick="updateGaugeMetric('quality')">Qualidade</button>
                                    <button class="chart-option-btn" onclick="updateGaugeMetric('efficiency')">Eficiência</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="gaugeChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Gráfico Radar de Departamentos -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <div class="chart-title">
                                    🎯 Radar: Performance por Departamento
                                </div>
                                <div class="chart-options">
                                    <button class="chart-option-btn active" onclick="updateRadarPeriod('current')">Atual</button>
                                    <button class="chart-option-btn" onclick="updateRadarPeriod('previous')">Anterior</button>
                                    <button class="chart-option-btn" onclick="updateRadarPeriod('comparison')">Comparar</button>
                                    <button class="chart-option-btn" onclick="drillDown('radar')">🔍</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="radarChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Aba Analytics -->
            <div id="analyticsTab" class="tab-content" style="display: none;">
                <div class="charts-dashboard">
                    <div class="dashboard-header">
                        <div class="dashboard-title">
                            📈 Analytics Avançado
                        </div>
                    </div>
                    <!-- Conteúdo de analytics será adicionado aqui -->
                    <div class="loading">
                        <div class="spinner"></div>
                        Em desenvolvimento...
                    </div>
                </div>
            </div>
            
            <!-- Aba Relatórios -->
            <div id="reportsTab" class="tab-content" style="display: none;">
                <div class="charts-dashboard">
                    <div class="dashboard-header">
                        <div class="dashboard-title">
                            📋 Relatórios Personalizados
                        </div>
                    </div>
                    <!-- Conteúdo de relatórios será adicionado aqui -->
                    <div class="loading">
                        <div class="spinner"></div>
                        Em desenvolvimento...
                    </div>
                </div>
            </div>
        </div>
        
        <div class="right-section">
            <!-- Painel lateral será implementado aqui -->
            <h3>🔧 Ferramentas</h3>
            <p>Painel de ferramentas em desenvolvimento...</p>
        </div>
    </div>
    
    <!-- Modal para Drill-down -->
    <div id="drilldownModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Análise Detalhada</h2>
                <button class="close" onclick="closeDrilldown()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Conteúdo do drill-down será inserido aqui -->
            </div>
        </div>
    </div>
    
    <script>
        // Configuração global do Chart.js
        Chart.register(ChartDataLabels);
        Chart.defaults.font.family = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
        Chart.defaults.font.size = 12;
        Chart.defaults.color = '#666';
        
        // Variáveis globais
        let charts = {};
        let chartsData = {};
        let currentTab = 'dashboard';
        
        // Cores personalizadas
        const colors = {
            primary: ['#007bff', '#0056b3', '#004085'],
            success: ['#28a745', '#1e7e34', '#155724'],
            warning: ['#ffc107', '#e0a800', '#d39e00'],
            danger: ['#dc3545', '#c82333', '#bd2130'],
            info: ['#17a2b8', '#138496', '#117a8b'],
            gradient: {
                blue: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                green: 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)',
                orange: 'linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%)',
                purple: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
            }
        };
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Inicializando Dashboard Avançado...');
            loadUserInfo();
            loadChartData();
            setupEventListeners();
        });
        
        // Carregar informações do usuário
        async function loadUserInfo() {
            try {
                const response = await fetch('/api/user/info', { credentials: 'include' });
                const data = await response.json();
                
                if (data && data.success) {
                    document.getElementById('userName').textContent = data.user.name;
                    document.getElementById('userDepartment').textContent = data.user.department;
                    document.getElementById('userAvatar').textContent = data.user.name.charAt(0).toUpperCase();
                }
            } catch (error) {
                console.error('❌ Erro ao carregar informações do usuário:', error);
            }
        }
        
        // Carregar dados dos gráficos
        async function loadChartData() {
            try {
                const period = document.getElementById('chartPeriod').value;
                const filter = document.getElementById('chartFilter').value;
                
                console.log(`📊 Carregando dados para período: ${period} dias, filtro: ${filter}`);
                
                const response = await fetch(`/api/charts/enhanced-data?period=${period}&filter=${filter}`, {
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    chartsData = data.data;
                    updateKPIs(data.data.kpis);
                    createAllCharts(data.data);
                } else {
                    console.error('❌ Erro ao carregar dados:', data.message);
                }
            } catch (error) {
                console.error('❌ Erro na requisição:', error);
                // Usar dados simulados para demonstração
                loadMockData();
            }
        }
        
        // Dados simulados para demonstração
        function loadMockData() {
            console.log('📊 Carregando dados simulados...');
            
            const mockData = {
                kpis: {
                    total: 156,
                    pending: 23,
                    resolved: 98,
                    critical: 8,
                    avgResolutionTime: 4.2
                },
                trend: generateMockTrendData(),
                status: [
                    { label: 'Pendente', count: 23, color: '#ffc107' },
                    { label: 'Em Análise', count: 15, color: '#17a2b8' },
                    { label: 'Em Andamento', count: 20, color: '#007bff' },
                    { label: 'Resolvido', count: 98, color: '#28a745' }
                ],
                priority: [
                    { label: 'Baixa', count: 45, color: '#28a745' },
                    { label: 'Média', count: 67, color: '#ffc107' },
                    { label: 'Alta', count: 36, color: '#fd7e14' },
                    { label: 'Crítica', count: 8, color: '#dc3545' }
                ],
                departments: generateMockDepartmentData(),
                heatmap: generateMockHeatmapData()
            };
            
            chartsData = mockData;
            updateKPIs(mockData.kpis);
            createAllCharts(mockData);
        }
        
        // Gerar dados simulados de tendência
        function generateMockTrendData() {
            const data = [];
            const today = new Date();
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                
                data.push({
                    date: date.toISOString().split('T')[0],
                    count: Math.floor(Math.random() * 10) + 1,
                    resolved: Math.floor(Math.random() * 8),
                    pending: Math.floor(Math.random() * 5)
                });
            }
            
            return data;
        }
        
        // Gerar dados simulados de departamentos
        function generateMockDepartmentData() {
            const departments = ['Produção', 'Qualidade', 'Engenharia', 'Manutenção', 'Logística'];
            return departments.map(dept => ({
                label: dept,
                count: Math.floor(Math.random() * 30) + 5,
                efficiency: Math.floor(Math.random() * 40) + 60
            }));
        }
        
        // Gerar dados simulados de heatmap
        function generateMockHeatmapData() {
            const days = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'];
            const hours = Array.from({length: 24}, (_, i) => i);
            const data = [];
            
            days.forEach((day, dayIndex) => {
                hours.forEach(hour => {
                    data.push({
                        x: hour,
                        y: dayIndex,
                        v: Math.floor(Math.random() * 10)
                    });
                });
            });
            
            return data;
        }
        
        // Atualizar KPIs
        function updateKPIs(kpis) {
            document.getElementById('totalRncs').textContent = kpis.total || 0;
            document.getElementById('pendingRncs').textContent = kpis.pending || 0;
            document.getElementById('resolvedRncs').textContent = kpis.resolved || 0;
            document.getElementById('criticalRncs').textContent = kpis.critical || 0;
            document.getElementById('avgResolutionTime').textContent = (kpis.avgResolutionTime || 0).toFixed(1);
        }
        
        // Criar todos os gráficos
        function createAllCharts(data) {
            // Destruir gráficos existentes
            Object.values(charts).forEach(chart => {
                if (chart && typeof chart.destroy === 'function') {
                    chart.destroy();
                }
            });
            charts = {};
            
            // Criar novos gráficos
            createTrendChart(data.trend);
            createStatusChart(data.status);
            createPriorityChart(data.priority);
            createHeatmapChart(data.heatmap);
            createGaugeChart(85); // Performance simulada
            createRadarChart(data.departments);
        }
        
        // Gráfico de Tendência
        function createTrendChart(data) {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            charts.trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(item => {
                        const date = new Date(item.date);
                        return date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
                    }),
                    datasets: [{
                        label: 'RNCs Criados',
                        data: data.map(item => item.count),
                        borderColor: colors.primary[0],
                        backgroundColor: colors.primary[0] + '20',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: colors.primary[0],
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }, {
                        label: 'Resolvidos',
                        data: data.map(item => item.resolved || 0),
                        borderColor: colors.success[0],
                        backgroundColor: colors.success[0] + '20',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: colors.primary[0],
                            borderWidth: 1,
                            cornerRadius: 8,
                            displayColors: true
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                maxTicksLimit: 10
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const date = data[index].date;
                            drillDownTrend(date);
                        }
                    }
                }
            });
            
            // Atualizar estatísticas
            const total = data.reduce((sum, item) => sum + item.count, 0);
            const avg = (total / data.length).toFixed(1);
            const peak = Math.max(...data.map(item => item.count));
            const growth = ((data[data.length - 1].count - data[0].count) / data[0].count * 100).toFixed(1);
            
            document.getElementById('trendTotal').textContent = total;
            document.getElementById('trendAvg').textContent = avg;
            document.getElementById('trendPeak').textContent = peak;
            document.getElementById('trendGrowth').textContent = growth + '%';
        }
        
        // Gráfico de Status
        function createStatusChart(data) {
            const ctx = document.getElementById('statusChart').getContext('2d');
            
            charts.statusChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.map(item => item.label),
                    datasets: [{
                        data: data.map(item => item.count),
                        backgroundColor: data.map(item => item.color),
                        borderWidth: 3,
                        borderColor: '#fff',
                        hoverBorderWidth: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        datalabels: {
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 14
                            },
                            formatter: (value, context) => {
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((value / total) * 100).toFixed(1);
                                return percentage + '%';
                            }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const status = data[index].label;
                            drillDownStatus(status);
                        }
                    }
                }
            });
        }
        
        // Gráfico de Prioridades
        function createPriorityChart(data) {
            const ctx = document.getElementById('priorityChart').getContext('2d');
            
            charts.priorityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(item => item.label),
                    datasets: [{
                        label: 'RNCs',
                        data: data.map(item => item.count),
                        backgroundColor: data.map(item => item.color),
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        datalabels: {
                            anchor: 'end',
                            align: 'top',
                            color: '#333',
                            font: {
                                weight: 'bold'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const priority = data[index].label;
                            drillDownPriority(priority);
                        }
                    }
                }
            });
        }
        
        // Gráfico Heatmap (simulado com scatter)
        function createHeatmapChart(data) {
            const ctx = document.getElementById('heatmapChart').getContext('2d');
            
            charts.heatmapChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Intensidade',
                        data: data,
                        backgroundColor: (context) => {
                            const value = context.parsed.v || 0;
                            const intensity = value / 10;
                            return `rgba(220, 53, 69, ${intensity})`;
                        },
                        pointRadius: 15,
                        pointHoverRadius: 18
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: () => '',
                                label: (context) => {
                                    const days = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'];
                                    const day = days[context.parsed.y];
                                    const hour = context.parsed.x;
                                    const value = context.parsed.v;
                                    return `${day} ${hour}:00 - ${value} RNCs`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            min: 0,
                            max: 23,
                            ticks: {
                                stepSize: 2,
                                callback: (value) => value + 'h'
                            },
                            title: {
                                display: true,
                                text: 'Hora do Dia'
                            }
                        },
                        y: {
                            type: 'linear',
                            min: -0.5,
                            max: 6.5,
                            ticks: {
                                stepSize: 1,
                                callback: (value) => {
                                    const days = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'];
                                    return days[value] || '';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Dia da Semana'
                            }
                        }
                    }
                }
            });
        }
        
        // Gráfico Gauge (simulado com doughnut)
        function createGaugeChart(value) {
            const ctx = document.getElementById('gaugeChart').getContext('2d');
            
            charts.gaugeChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [value, 100 - value],
                        backgroundColor: [
                            value >= 80 ? colors.success[0] : value >= 60 ? colors.warning[0] : colors.danger[0],
                            '#e9ecef'
                        ],
                        borderWidth: 0,
                        cutout: '80%'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    circumference: 180,
                    rotation: 270,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false
                        }
                    }
                },
                plugins: [{
                    afterDraw: (chart) => {
                        const ctx = chart.ctx;
                        const centerX = chart.chartArea.left + (chart.chartArea.right - chart.chartArea.left) / 2;
                        const centerY = chart.chartArea.top + (chart.chartArea.bottom - chart.chartArea.top) / 2;
                        
                        ctx.save();
                        ctx.font = 'bold 24px Arial';
                        ctx.fillStyle = '#333';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(value + '%', centerX, centerY);
                        
                        ctx.font = '12px Arial';
                        ctx.fillStyle = '#666';
                        ctx.fillText('Performance', centerX, centerY + 25);
                        ctx.restore();
                    }
                }]
            });
        }
        
        // Gráfico Radar
        function createRadarChart(data) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            
            charts.radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: data.map(item => item.label),
                    datasets: [{
                        label: 'Eficiência Atual',
                        data: data.map(item => item.efficiency),
                        backgroundColor: colors.primary[0] + '30',
                        borderColor: colors.primary[0],
                        borderWidth: 3,
                        pointBackgroundColor: colors.primary[0],
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    }
                }
            });
        }
        
        // Funções de interação
        function switchTab(tabName) {
            try {
                document.querySelectorAll('.tab-button').forEach(function(btn){ btn.classList.remove('active'); });
                if (window.event && window.event.target) {
                    window.event.target.classList.add('active');
                } else {
                    var btn = document.querySelector('.tab-button[onclick*="' + tabName + '"]');
                    if (btn) btn.classList.add('active');
                }
            } catch (e) {}

            try {
                document.querySelectorAll('.tab-content').forEach(function(content){ content.style.display = 'none'; });
                var target = document.getElementById(tabName + 'Tab');
                if (target) target.style.display = 'block';
            } catch (e) {}
            currentTab = tabName;
            // Se existir um carregador de dados para a aba, chamá-lo
            try {
                if (tabName === 'dashboard' && typeof loadChartData === 'function') loadChartData();
            } catch (e) {}
        }
        
        function changeChartType(chartId, newType) {
            const chart = charts[chartId];
            if (chart) {
                chart.config.type = newType;
                chart.update();
                
                // Atualizar botões ativos
                const card = document.getElementById(chartId).closest('.chart-card');
                card.querySelectorAll('.chart-option-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
            }
        }
        
        function drillDown(chartType) {
            const modal = document.getElementById('drilldownModal');
            const title = document.getElementById('modalTitle');
            const body = document.getElementById('modalBody');
            
            title.textContent = `Análise Detalhada - ${chartType.charAt(0).toUpperCase() + chartType.slice(1)}`;
            body.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    Carregando análise detalhada...
                </div>
            `;
            
            modal.style.display = 'block';
            
            // Simular carregamento
            setTimeout(() => {
                body.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <h3>🔍 Análise Detalhada</h3>
                        <p>Esta funcionalidade será implementada em breve.</p>
                        <p>Aqui você poderá ver dados granulares e filtros avançados.</p>
                    </div>
                `;
            }, 1500);
        }
        
        function closeDrilldown() {
            document.getElementById('drilldownModal').style.display = 'none';
        }
        
        function refreshAllCharts() {
            loadChartData();
        }
        
        function applyChartFilter() {
            loadChartData();
        }
        
        function exportDashboard() {
            alert('Funcionalidade de exportação será implementada em breve!');
        }
        
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }
        
        function setupEventListeners() {
            // Fechar modal ao clicar fora
            window.onclick = function(event) {
                const modal = document.getElementById('drilldownModal');
                if (event.target === modal) {
                    closeDrilldown();
                }
            };
            
            // Atalhos de teclado
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    closeDrilldown();
                }
                if (event.key === 'F5') {
                    event.preventDefault();
                    refreshAllCharts();
                }
            });
        }
        
        // Funções específicas de drill-down
        function drillDownTrend(date) {
            console.log('Drill-down para tendência na data:', date);
            drillDown('trend');
        }
        
        function drillDownStatus(status) {
            console.log('Drill-down para status:', status);
            drillDown('status');
        }
        
        function drillDownPriority(priority) {
            console.log('Drill-down para prioridade:', priority);
            drillDown('priority');
        }
        
        // Funções de atualização de gráficos específicos
        function toggleHeatmapView(period) {
            console.log('Alterando visualização do heatmap para:', period);
            // Implementar lógica específica do heatmap
        }
        
        function updateGaugeMetric(metric) {
            console.log('Atualizando gauge para métrica:', metric);
            let value;
            switch(metric) {
                case 'resolution': value = 85; break;
                case 'quality': value = 92; break;
                case 'efficiency': value = 78; break;
                default: value = 85;
            }
            
            if (charts.gaugeChart) {
                charts.gaugeChart.destroy();
            }
            createGaugeChart(value);
        }
        
        function updateRadarPeriod(period) {
            console.log('Atualizando radar para período:', period);
            // Implementar lógica específica do radar
        }
        
        // Utilitários
        function formatNumber(num) {
            return new Intl.NumberFormat('pt-BR').format(num);
        }
        
        function formatDate(date) {
            return new Date(date).toLocaleDateString('pt-BR');
        }
        
        function getColorByValue(value, max) {
            const percentage = value / max;
            if (percentage >= 0.8) return colors.success[0];
            if (percentage >= 0.6) return colors.warning[0];
            if (percentage >= 0.4) return colors.info[0];
            return colors.danger[0];
        }
        
        // Animações e efeitos
        function animateValue(element, start, end, duration) {
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    current = end;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current);
            }, 16);
        }
        
        // Responsividade avançada
        function handleResize() {
            Object.values(charts).forEach(chart => {
                if (chart && typeof chart.resize === 'function') {
                    chart.resize();
                }
            });
        }
        
        window.addEventListener('resize', handleResize);
        
        // Logs para debug
        console.log('🎨 Dashboard Avançado carregado com sucesso!');
        console.log('📊 Gráficos disponíveis:', Object.keys(charts));
    </script>
</body>
</html>