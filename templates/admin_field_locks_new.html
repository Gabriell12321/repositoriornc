<!DOCTYPE html><!DOCTYPE html><!DOCTYPE html>

<html lang="pt-BR">

<head><html lang="pt-BR"><html lang="pt-BR">

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0"><head><head>

    <title>üîê Permiss√µes de Campos RNC - IPPEL</title>

    <style>    <meta charset="UTF-8">    <meta charset="UTF-8">

        * {

            margin: 0;    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta name="viewport" content="width=device-width, initial-scale=1.0">

            padding: 0;

            box-sizing: border-box;    <title>üîê Gerenciar Permiss√µes de Campos RNC</title>    <title>üîê Permiss√µes de Campos RNC - IPPEL</title>

        }

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">    <style>

        body {

            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;    <style>        * {

            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

            min-height: 100vh;        * {            margin: 0;

            color: #333;

        }            margin: 0;            padding: 0;



        .container {            padding: 0;            box-sizing: border-box;

            max-width: 1600px;

            margin: 0 auto;            box-sizing: border-box;        }

            padding: 20px;

        }        }



        .header {        body {

            background: white;

            border-radius: 15px;        body {            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;

            padding: 30px;

            margin-bottom: 25px;            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);

            text-align: center;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);            min-height: 100vh;

        }

            min-height: 100vh;            color: #333;

        .header h1 {

            color: #2c3e50;            color: #333;        }

            margin-bottom: 10px;

            font-size: 2.2em;        }

        }

        .container {

        .header p {

            color: #7f8c8d;        .container {            max-width: 1600px;

            font-size: 1.1em;

        }            max-width: 1400px;            margin: 0 auto;



        .main-content {            margin: 0 auto;            padding: 20px;

            display: grid;

            grid-template-columns: 300px 1fr;            padding: 20px;        }

            gap: 25px;

        }        }



        .sidebar {        .header {

            background: white;

            border-radius: 15px;        .header {            background: white;

            padding: 25px;

            height: fit-content;            text-align: center;            border-radius: 15px;

            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);

        }            margin-bottom: 30px;            padding: 30px;



        .sidebar h3 {            color: white;            margin-bottom: 25px;

            color: #2c3e50;

            margin-bottom: 20px;        }            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);

            padding-bottom: 10px;

            border-bottom: 2px solid #667eea;            text-align: center;

        }

        .header h1 {        }

        .group-list {

            list-style: none;            font-size: 2.5rem;

        }

            margin-bottom: 10px;        .header h1 {

        .group-item {

            padding: 15px;            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);            color: #2c3e50;

            margin: 8px 0;

            border-radius: 10px;        }            margin-bottom: 10px;

            cursor: pointer;

            transition: all 0.3s ease;            font-size: 2.2em;

            border: 2px solid transparent;

        }        .header p {        }



        .group-item:hover {            font-size: 1.1rem;

            background: #f8f9fa;

            transform: translateX(5px);            opacity: 0.9;        .header p {

        }

        }            color: #7f8c8d;

        .group-item.active {

            background: linear-gradient(135deg, #667eea, #764ba2);            font-size: 1.1em;

            color: white;

            border-color: #5a6fd8;        .main-content {        }

        }

            display: grid;

        .group-name {

            font-weight: bold;            grid-template-columns: 350px 1fr;        .main-content {

            font-size: 1.1em;

        }            gap: 30px;            display: grid;



        .group-desc {            height: calc(100vh - 200px);            grid-template-columns: 300px 1fr;

            font-size: 0.9em;

            opacity: 0.8;        }            gap: 25px;

            margin-top: 5px;

        }        }



        .content-area {        .sidebar {

            background: white;

            border-radius: 15px;            background: white;        .sidebar {

            padding: 30px;

            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);            border-radius: 20px;            background: white;

        }

            padding: 25px;            border-radius: 15px;

        .loading {

            text-align: center;            box-shadow: 0 15px 35px rgba(0,0,0,0.1);            padding: 25px;

            padding: 100px 50px;

            color: #7f8c8d;            overflow-y: auto;            height: fit-content;

            font-size: 1.2em;

        }        }            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);



        .actions-bar {        }

            display: flex;

            gap: 15px;        .sidebar h2 {

            margin-bottom: 30px;

            flex-wrap: wrap;            color: #4f46e5;        .sidebar h3 {

        }

            margin-bottom: 20px;            color: #2c3e50;

        .btn {

            padding: 12px 24px;            font-size: 1.3rem;            margin-bottom: 20px;

            border: none;

            border-radius: 8px;            display: flex;            padding-bottom: 10px;

            cursor: pointer;

            font-weight: bold;            align-items: center;            border-bottom: 2px solid #667eea;

            font-size: 14px;

            transition: all 0.3s ease;            gap: 10px;        }

            display: flex;

            align-items: center;        }

            gap: 8px;

        }        .group-list {



        .btn-primary {        .search-box {            list-style: none;

            background: linear-gradient(135deg, #3498db, #2980b9);

            color: white;            position: relative;        }

        }

            margin-bottom: 20px;

        .btn-primary:hover {

            transform: translateY(-2px);        }        .group-item {

            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);

        }            padding: 15px;



        .btn-success {        .search-box input {            margin: 8px 0;

            background: linear-gradient(135deg, #27ae60, #229954);

            color: white;            width: 100%;            border-radius: 10px;

        }

            padding: 12px 40px 12px 16px;            cursor: pointer;

        .btn-success:hover {

            transform: translateY(-2px);            border: 2px solid #e5e7eb;            transition: all 0.3s ease;

            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);

        }            border-radius: 12px;            border: 2px solid transparent;



        .btn-danger {            font-size: 14px;        }

            background: linear-gradient(135deg, #e74c3c, #c0392b);

            color: white;            transition: all 0.3s ease;

        }

        }        .group-item:hover {

        .btn-danger:hover {

            transform: translateY(-2px);            background: #f8f9fa;

            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);

        }        .search-box input:focus {            transform: translateX(5px);



        .btn-warning {            outline: none;        }

            background: linear-gradient(135deg, #f39c12, #e67e22);

            color: white;            border-color: #4f46e5;

        }

            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);        .group-item.active {

        .btn-warning:hover {

            transform: translateY(-2px);        }            background: linear-gradient(135deg, #667eea, #764ba2);

            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);

        }            color: white;



        .rnc-form-preview {        .search-box i {            border-color: #5a6fd8;

            border: 2px solid #e9ecef;

            border-radius: 12px;            position: absolute;        }

            padding: 30px;

            background: #fafbfc;            right: 12px;

            margin-top: 20px;

        }            top: 50%;        .group-name {



        .form-section {            transform: translateY(-50%);            font-weight: bold;

            margin-bottom: 30px;

        }            color: #9ca3af;            font-size: 1.1em;



        .section-title {        }        }

            background: linear-gradient(135deg, #667eea, #764ba2);

            color: white;

            padding: 12px 20px;

            border-radius: 8px;        .groups-list {        .group-desc {

            margin-bottom: 20px;

            font-weight: bold;            list-style: none;            font-size: 0.9em;

            text-align: center;

        }        }            opacity: 0.8;



        .form-row {            margin-top: 5px;

            display: grid;

            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));        .group-item {        }

            gap: 20px;

            margin-bottom: 20px;            background: #f8fafc;

        }

            border: 2px solid transparent;        .content-area {

        .field-container {

            position: relative;            border-radius: 12px;            background: white;

        }

            padding: 15px;            border-radius: 15px;

        .field-preview {

            border: 2px solid #ddd;            margin-bottom: 10px;            padding: 30px;

            border-radius: 8px;

            padding: 12px;            cursor: pointer;            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);

            background: white;

            cursor: pointer;            transition: all 0.3s ease;        }

            transition: all 0.3s ease;

            min-height: 50px;            position: relative;

            display: flex;

            flex-direction: column;        }        .loading {

            justify-content: center;

        }            text-align: center;



        .field-preview:hover {        .group-item:hover {            padding: 100px 50px;

            transform: translateY(-2px);

            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);            background: #e0e7ff;            color: #7f8c8d;

        }

            transform: translateY(-2px);            font-size: 1.2em;

        .field-preview.unlocked {

            border-color: #27ae60;            box-shadow: 0 8px 25px rgba(0,0,0,0.1);        }

            background: linear-gradient(135deg, #d5f4e6, #ffffff);

        }        }



        .field-preview.locked {        .actions-bar {

            border-color: #e74c3c;

            background: linear-gradient(135deg, #fadbd8, #ffffff);        .group-item.active {            display: flex;

            opacity: 0.8;

        }            background: linear-gradient(135deg, #4f46e5, #7c3aed);            gap: 15px;



        .field-label {            color: white;            margin-bottom: 30px;

            font-weight: bold;

            color: #2c3e50;            border-color: #4f46e5;            flex-wrap: wrap;

            margin-bottom: 5px;

            display: flex;        }        }

            align-items: center;

            gap: 8px;

        }

        .group-name {        .btn {

        .field-placeholder {

            color: #7f8c8d;            font-weight: 600;            padding: 12px 24px;

            font-style: italic;

            font-size: 0.9em;            font-size: 1rem;            border: none;

        }

            margin-bottom: 5px;            border-radius: 8px;

        .field-status {

            position: absolute;        }            cursor: pointer;

            top: -8px;

            right: -8px;            font-weight: bold;

            width: 24px;

            height: 24px;        .group-desc {            font-size: 14px;

            border-radius: 50%;

            display: flex;            font-size: 0.85rem;            transition: all 0.3s ease;

            align-items: center;

            justify-content: center;            opacity: 0.7;            display: flex;

            font-size: 12px;

            font-weight: bold;        }            align-items: center;

            color: white;

        }            gap: 8px;



        .field-status.unlocked {        .no-groups {        }

            background: #27ae60;

        }            text-align: center;



        .field-status.locked {            color: #ef4444;        .btn-primary {

            background: #e74c3c;

        }            padding: 20px;            background: linear-gradient(135deg, #3498db, #2980b9);



        .legend {            font-weight: 500;            color: white;

            display: flex;

            gap: 30px;        }        }

            justify-content: center;

            margin-bottom: 20px;

            padding: 15px;

            background: white;        .content-area {        .btn-primary:hover {

            border-radius: 10px;

            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);            background: white;            transform: translateY(-2px);

        }

            border-radius: 20px;            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);

        .legend-item {

            display: flex;            padding: 30px;        }

            align-items: center;

            gap: 10px;            box-shadow: 0 15px 35px rgba(0,0,0,0.1);

            font-weight: bold;

        }            overflow-y: auto;        .btn-success {



        .legend-color {        }            background: linear-gradient(135deg, #27ae60, #229954);

            width: 20px;

            height: 20px;            color: white;

            border-radius: 4px;

            border: 2px solid #ddd;        .loading-state {        }

        }

            display: flex;

        .legend-color.unlocked {

            background: linear-gradient(135deg, #d5f4e6, #ffffff);            flex-direction: column;        .btn-success:hover {

            border-color: #27ae60;

        }            align-items: center;            transform: translateY(-2px);



        .legend-color.locked {            justify-content: center;            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);

            background: linear-gradient(135deg, #fadbd8, #ffffff);

            border-color: #e74c3c;            height: 100%;        }

        }

            color: #6b7280;

        .alert {

            padding: 15px;        }        .btn-danger {

            border-radius: 8px;

            margin: 15px 0;            background: linear-gradient(135deg, #e74c3c, #c0392b);

            font-weight: bold;

        }        .loading-state i {            color: white;



        .alert-success {            font-size: 3rem;        }

            background: #d4edda;

            color: #155724;            margin-bottom: 15px;

            border: 1px solid #c3e6cb;

        }            opacity: 0.3;        .btn-danger:hover {



        .alert-error {        }            transform: translateY(-2px);

            background: #f8d7da;

            color: #721c24;            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);

            border: 1px solid #f5c6cb;

        }        .group-content {        }



        .search-box {            display: none;

            width: 100%;

            padding: 12px;        }        .btn-warning {

            border: 1px solid #ddd;

            border-radius: 8px;            background: linear-gradient(135deg, #f39c12, #e67e22);

            margin-bottom: 20px;

            font-size: 16px;        .group-header {            color: white;

        }

            display: flex;        }

        @media (max-width: 768px) {

            .main-content {            justify-content: between;

                grid-template-columns: 1fr;

            }            align-items: center;        .btn-warning:hover {

            

            .form-row {            margin-bottom: 30px;            transform: translateY(-2px);

                grid-template-columns: 1fr;

            }            padding-bottom: 20px;            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);



            .actions-bar {            border-bottom: 2px solid #e5e7eb;        }

                flex-direction: column;

            }        }

        }

    </style>        .rnc-form-preview {

</head>

<body>        .group-title {            border: 2px solid #e9ecef;

    <div class="container">

        <div class="header">            font-size: 1.8rem;            border-radius: 12px;

            <h1>üîê Gerenciar Permiss√µes de Campos RNC</h1>

            <p>Clique nos campos abaixo para bloquear/desbloquear o acesso por grupo</p>            color: #1f2937;            padding: 30px;

        </div>

            font-weight: 700;            background: #fafbfc;

        <div class="main-content">

            <div class="sidebar">        }            margin-top: 20px;

                <h3>üë• Grupos</h3>

                <input type="text" class="search-box" id="groupSearch" placeholder="Buscar grupo...">        }

                <ul class="group-list" id="groupList">

                    <!-- Grupos ser√£o carregados via JavaScript -->        .stats-container {

                </ul>

            </div>            display: flex;        .form-section {



            <div class="content-area">            gap: 20px;            margin-bottom: 30px;

                <div id="loading" class="loading">

                    <p>üìã Selecione um grupo para configurar as permiss√µes</p>            margin-bottom: 30px;        }

                </div>

        }

                <div id="groupContent" style="display: none;">

                    <h3 id="groupTitle">Configura√ß√µes do Grupo</h3>        .section-title {

                    

                    <div class="actions-bar">        .stat-card {            background: linear-gradient(135deg, #667eea, #764ba2);

                        <button class="btn btn-success" onclick="saveChanges()">üíæ Salvar Altera√ß√µes</button>

                        <button class="btn btn-primary" onclick="unlockAll()">üîì Liberar Todos</button>            background: linear-gradient(135deg, #10b981, #059669);            color: white;

                        <button class="btn btn-warning" onclick="lockAll()">üîí Bloquear Todos</button>

                        <button class="btn btn-danger" onclick="resetGroup()">üóëÔ∏è Resetar Grupo</button>            color: white;            padding: 12px 20px;

                    </div>

            padding: 20px;            border-radius: 8px;

                    <div id="alerts"></div>

            border-radius: 16px;            margin-bottom: 20px;

                    <div class="legend">

                        <div class="legend-item">            text-align: center;            font-weight: bold;

                            <div class="legend-color unlocked"></div>

                            <span>üîì Campo Liberado (clique para bloquear)</span>            flex: 1;            text-align: center;

                        </div>

                        <div class="legend-item">            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.2);        }

                            <div class="legend-color locked"></div>

                            <span>üîí Campo Bloqueado (clique para liberar)</span>        }

                        </div>

                    </div>        .form-row {



                    <div class="rnc-form-preview">        .stat-card.locked {            display: grid;

                        <div class="section-title">üìã INFORMA√á√ïES PRINCIPAIS DO RNC</div>

                                    background: linear-gradient(135deg, #ef4444, #dc2626);            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));

                        <div class="form-section">

                            <div class="form-row">            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.2);            gap: 20px;

                                <div class="field-container">

                                    <div class="field-preview" data-field="title">        }            margin-bottom: 20px;

                                        <div class="field-label">üìù T√≠tulo do RNC</div>

                                        <div class="field-placeholder">Ex: Falha no equipamento de produ√ß√£o - Linha A</div>        }

                                        <div class="field-status"></div>

                                    </div>        .stat-number {

                                </div>

                                <div class="field-container">            font-size: 2rem;        .field-container {

                                    <div class="field-preview" data-field="equipment">

                                        <div class="field-label">üîß Equipamento/Sistema</div>            font-weight: 700;            position: relative;

                                        <div class="field-placeholder">Ex: Linha de montagem A, M√°quina X, Sistema Y</div>

                                        <div class="field-status"></div>            margin-bottom: 5px;        }

                                    </div>

                                </div>        }

                                <div class="field-container">

                                    <div class="field-preview" data-field="client">        .field-preview {

                                        <div class="field-label">üè¢ Cliente/Departamento</div>

                                        <div class="field-placeholder">Selecione o cliente</div>        .stat-label {            border: 2px solid #ddd;

                                        <div class="field-status"></div>

                                    </div>            font-size: 0.9rem;            border-radius: 8px;

                                </div>

                            </div>            opacity: 0.9;            padding: 12px;



                            <div class="form-row">        }            background: white;

                                <div class="field-container">

                                    <div class="field-preview" data-field="description">            cursor: pointer;

                                        <div class="field-label">üìÑ Descri√ß√£o</div>

                                        <div class="field-placeholder">Descreva brevemente o problema identificado</div>        .actions-bar {            transition: all 0.3s ease;

                                        <div class="field-status"></div>

                                    </div>            display: flex;            min-height: 50px;

                                </div>

                            </div>            gap: 15px;            display: flex;



                            <div class="form-row">            margin-bottom: 30px;            flex-direction: column;

                                <div class="field-container">

                                    <div class="field-preview" data-field="priority">            flex-wrap: wrap;            justify-content: center;

                                        <div class="field-label">‚ö° N√≠vel de Urg√™ncia</div>

                                        <div class="field-placeholder">üî¥ M√©dia - Resolver em at√© 7 dias</div>        }        }

                                        <div class="field-status"></div>

                                    </div>

                                </div>

                                <div class="field-container">        .btn {        .field-preview:hover {

                                    <div class="field-preview" data-field="price">

                                        <div class="field-label">üí∞ Custo Estimado (R$)</div>            padding: 12px 24px;            transform: translateY(-2px);

                                        <div class="field-placeholder">Custo estimado para corre√ß√£o do impacto financeiro</div>

                                        <div class="field-status"></div>            border: none;            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);

                                    </div>

                                </div>            border-radius: 12px;        }

                            </div>

                        </div>            font-weight: 600;



                        <div class="section-title">üë• RESPONSABILIDADES</div>            cursor: pointer;        .field-preview.unlocked {

                        

                        <div class="form-section">            transition: all 0.3s ease;            border-color: #27ae60;

                            <div class="form-row">

                                <div class="field-container">            display: flex;            background: linear-gradient(135deg, #d5f4e6, #ffffff);

                                    <div class="field-preview" data-field="responsavel">

                                        <div class="field-label">üë§ Respons√°vel pela Detec√ß√£o</div>            align-items: center;        }

                                        <div class="field-placeholder">Nome do funcion√°rio que detectou</div>

                                        <div class="field-status"></div>            gap: 8px;

                                    </div>

                                </div>            font-size: 14px;        .field-preview.locked {

                                <div class="field-container">

                                    <div class="field-preview" data-field="inspetor">        }            border-color: #e74c3c;

                                        <div class="field-label">üîç Inspetor</div>

                                        <div class="field-placeholder">Quem identificou o problema</div>            background: linear-gradient(135deg, #fadbd8, #ffffff);

                                        <div class="field-status"></div>

                                    </div>        .btn-primary {            opacity: 0.8;

                                </div>

                                <div class="field-container">            background: linear-gradient(135deg, #4f46e5, #7c3aed);        }

                                    <div class="field-preview" data-field="assigned_user_id">

                                        <div class="field-label">üìã Atribuir a um Usu√°rio</div>            color: white;

                                        <div class="field-placeholder">Filtrar por grupos selecionados</div>

                                        <div class="field-status"></div>        }        .field-label {

                                    </div>

                                </div>            font-weight: bold;

                            </div>

        .btn-success {            color: #2c3e50;

                            <div class="form-row">

                                <div class="field-container">            background: linear-gradient(135deg, #10b981, #059669);            margin-bottom: 5px;

                                    <div class="field-preview" data-field="setor">

                                        <div class="field-label">üè≠ Setor</div>            color: white;            display: flex;

                                        <div class="field-placeholder">Qual setor onde foi detectado</div>

                                        <div class="field-status"></div>        }            align-items: center;

                                    </div>

                                </div>            gap: 8px;

                                <div class="field-container">

                                    <div class="field-preview" data-field="area_responsavel">        .btn-danger {        }

                                        <div class="field-label">üìç √Årea/Localiza√ß√£o</div>

                                        <div class="field-placeholder">Ex: Setor de Produ√ß√£o, Cap√≠tulo 1, Piso 2</div>            background: linear-gradient(135deg, #ef4444, #dc2626);

                                        <div class="field-status"></div>

                                    </div>            color: white;        .field-placeholder {

                                </div>

                            </div>        }            color: #7f8c8d;

                        </div>

            font-style: italic;

                        <div class="section-title">üîß DADOS T√âCNICOS</div>

                                .btn-warning {            font-size: 0.9em;

                        <div class="form-section">

                            <div class="form-row">            background: linear-gradient(135deg, #f59e0b, #d97706);        }

                                <div class="field-container">

                                    <div class="field-preview" data-field="material">            color: white;

                                        <div class="field-label">üß± Material</div>

                                        <div class="field-placeholder">Descri√ß√£o do material</div>        }        .field-status {

                                        <div class="field-status"></div>

                                    </div>            position: absolute;

                                </div>

                                <div class="field-container">        .btn:hover {            top: -8px;

                                    <div class="field-preview" data-field="quantity">

                                        <div class="field-label">üìä Quantidade</div>            transform: translateY(-2px);            right: -8px;

                                        <div class="field-placeholder">Quantidade envolvida</div>

                                        <div class="field-status"></div>            box-shadow: 0 8px 25px rgba(0,0,0,0.2);            width: 24px;

                                    </div>

                                </div>        }            height: 24px;

                                <div class="field-container">

                                    <div class="field-preview" data-field="drawing">            border-radius: 50%;

                                        <div class="field-label">üìê Desenho</div>

                                        <div class="field-placeholder">N√∫mero do desenho</div>        .fields-grid {            display: flex;

                                        <div class="field-status"></div>

                                    </div>            display: grid;            align-items: center;

                                </div>

                            </div>            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));            justify-content: center;



                            <div class="form-row">            gap: 20px;            font-size: 12px;

                                <div class="field-container">

                                    <div class="field-preview" data-field="mp">        }            font-weight: bold;

                                        <div class="field-label">üî¢ MP</div>

                                        <div class="field-placeholder">C√≥digo MP</div>            color: white;

                                        <div class="field-status"></div>

                                    </div>        .field-category {        }

                                </div>

                                <div class="field-container">            background: #f8fafc;

                                    <div class="field-preview" data-field="revision">

                                        <div class="field-label">üîÑ Revis√£o</div>            border-radius: 16px;        .field-status.unlocked {

                                        <div class="field-placeholder">N√∫mero da revis√£o</div>

                                        <div class="field-status"></div>            padding: 20px;            background: #27ae60;

                                    </div>

                                </div>            border: 2px solid #e5e7eb;        }

                                <div class="field-container">

                                    <div class="field-preview" data-field="position">        }

                                        <div class="field-label">üìç Posi√ß√£o</div>

                                        <div class="field-placeholder">Posi√ß√£o no desenho</div>        .field-status.locked {

                                        <div class="field-status"></div>

                                    </div>        .category-header {            background: #e74c3c;

                                </div>

                            </div>            display: flex;        }



                            <div class="form-row">            align-items: center;

                                <div class="field-container">

                                    <div class="field-preview" data-field="cv">            gap: 10px;        .legend {

                                        <div class="field-label">üìã CV</div>

                                        <div class="field-placeholder">C√≥digo CV</div>            margin-bottom: 15px;            display: flex;

                                        <div class="field-status"></div>

                                    </div>            font-weight: 700;            gap: 30px;

                                </div>

                                <div class="field-container">            font-size: 1.1rem;            justify-content: center;

                                    <div class="field-preview" data-field="conjunto">

                                        <div class="field-label">üîß Conjunto</div>            color: #1f2937;            margin-bottom: 20px;

                                        <div class="field-placeholder">Nome do conjunto</div>

                                        <div class="field-status"></div>        }            padding: 15px;

                                    </div>

                                </div>            background: white;

                                <div class="field-container">

                                    <div class="field-preview" data-field="modelo">        .field-item {            border-radius: 10px;

                                        <div class="field-label">üéØ Modelo</div>

                                        <div class="field-placeholder">Modelo do equipamento</div>            background: white;            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);

                                        <div class="field-status"></div>

                                    </div>            border: 2px solid #e5e7eb;        }

                                </div>

                            </div>            border-radius: 12px;



                            <div class="form-row">            padding: 15px;        .legend-item {

                                <div class="field-container">

                                    <div class="field-preview" data-field="description_drawing">            margin-bottom: 10px;            display: flex;

                                        <div class="field-label">üìù Descri√ß√£o do Desenho</div>

                                        <div class="field-placeholder">Descri√ß√£o detalhada do desenho</div>            cursor: pointer;            align-items: center;

                                        <div class="field-status"></div>

                                    </div>            transition: all 0.3s ease;            gap: 10px;

                                </div>

                                <div class="field-container">            display: flex;            font-weight: bold;

                                    <div class="field-preview" data-field="purchase_order">

                                        <div class="field-label">üõí Ordem de Compra</div>            justify-content: space-between;        }

                                        <div class="field-placeholder">N√∫mero da ordem de compra</div>

                                        <div class="field-status"></div>            align-items: center;

                                    </div>

                                </div>        }        .legend-color {

                            </div>

            width: 20px;

                            <div class="form-row">

                                <div class="field-container">        .field-item:hover {            height: 20px;

                                    <div class="field-preview" data-field="justificativa">

                                        <div class="field-label">üí≠ Justificativa</div>            transform: translateY(-1px);            border-radius: 4px;

                                        <div class="field-placeholder">Justificativa para o RNC</div>

                                        <div class="field-status"></div>            box-shadow: 0 4px 15px rgba(0,0,0,0.1);            border: 2px solid #ddd;

                                    </div>

                                </div>        }        }

                            </div>

                        </div>

                    </div>

                </div>        .field-item.unlocked {        .legend-color.unlocked {

            </div>

        </div>            border-color: #10b981;            background: linear-gradient(135deg, #d5f4e6, #ffffff);

    </div>

            background: linear-gradient(135deg, #ecfdf5, #d1fae5);            border-color: #27ae60;

    <script>

        let currentGroupId = null;        }        }

        let fieldLocks = {};

        let hasChanges = false;



        const availableFields = [        .field-item.locked {        .legend-color.locked {

            'title', 'description', 'priority', 'price', 'responsavel', 'inspetor', 

            'setor', 'area_responsavel', 'equipment', 'client', 'assigned_user_id',            border-color: #ef4444;            background: linear-gradient(135deg, #fadbd8, #ffffff);

            'material', 'quantity', 'drawing', 'mp', 'revision', 'position',

            'cv', 'conjunto', 'modelo', 'description_drawing', 'purchase_order', 'justificativa'            background: linear-gradient(135deg, #fef2f2, #fecaca);            border-color: #e74c3c;

        ];

        }        }

        // Carregar grupos na inicializa√ß√£o

        document.addEventListener('DOMContentLoaded', function() {

            loadGroups();

            setupEventListeners();        .field-name {        .alert {

        });

            font-weight: 500;            padding: 15px;

        function setupEventListeners() {

            // Search functionality            color: #374151;            border-radius: 8px;

            document.getElementById('groupSearch').addEventListener('input', function(e) {

                filterGroups(e.target.value);        }            margin: 15px 0;

            });

            font-weight: bold;

            // Field click handlers

            document.querySelectorAll('.field-preview').forEach(field => {        .field-status {        }

                field.addEventListener('click', function() {

                    if (currentGroupId) {            font-size: 1.2rem;

                        toggleField(this.dataset.field);

                    }            padding: 8px;        .alert-success {

                });

            });            border-radius: 8px;            background: #d4edda;



            // Warning on page leave if there are unsaved changes            min-width: 40px;            color: #155724;

            window.addEventListener('beforeunload', function(e) {

                if (hasChanges) {            text-align: center;            border: 1px solid #c3e6cb;

                    e.preventDefault();

                    e.returnValue = 'Voc√™ tem altera√ß√µes n√£o salvas. Deseja continuar?';        }        }

                }

            });

        }

        .field-status.unlocked {        .alert-error {

        async function loadGroups() {

            try {            background: #10b981;            background: #f8d7da;

                const response = await fetch('/admin/field-locks/api/groups');

                const groups = await response.json();            color: white;            color: #721c24;

                

                const groupList = document.getElementById('groupList');        }            border: 1px solid #f5c6cb;

                groupList.innerHTML = '';

                        }

                groups.forEach(group => {

                    const li = document.createElement('li');        .field-status.locked {

                    li.className = 'group-item';

                    li.onclick = () => selectGroup(group.id, group.name);            background: #ef4444;        .search-box {

                    

                    li.innerHTML = `            color: white;            width: 100%;

                        <div class="group-name">${group.name}</div>

                        <div class="group-desc">${group.description || 'Sem descri√ß√£o'}</div>        }            padding: 12px;

                    `;

                                border: 1px solid #ddd;

                    groupList.appendChild(li);

                });        .alerts {            border-radius: 8px;

                

            } catch (error) {            position: fixed;            margin-bottom: 20px;

                console.error('Erro ao carregar grupos:', error);

                showAlert('Erro ao carregar grupos: ' + error.message, 'error');            top: 20px;            font-size: 16px;

            }

        }            right: 20px;        }



        function filterGroups(searchTerm) {            z-index: 1000;

            const groups = document.querySelectorAll('.group-item');

            const term = searchTerm.toLowerCase();        }        @media (max-width: 768px) {

            

            groups.forEach(group => {            .main-content {

                const text = group.textContent.toLowerCase();

                group.style.display = text.includes(term) ? 'block' : 'none';        .alert {                grid-template-columns: 1fr;

            });

        }            background: white;            }



        async function selectGroup(groupId, groupName) {            border-left: 4px solid;            

            // Verificar se h√° mudan√ßas n√£o salvas

            if (hasChanges) {            border-radius: 8px;            .form-row {

                const confirm = window.confirm('Voc√™ tem altera√ß√µes n√£o salvas. Deseja continuar sem salvar?');

                if (!confirm) return;            padding: 15px 20px;                grid-template-columns: 1fr;

            }

            margin-bottom: 10px;            }

            currentGroupId = groupId;

                        box-shadow: 0 8px 25px rgba(0,0,0,0.1);

            // Atualizar UI

            document.querySelectorAll('.group-item').forEach(item => {            animation: slideIn 0.3s ease;            .actions-bar {

                item.classList.remove('active');

            });            max-width: 300px;                flex-direction: column;

            

            event.target.closest('.group-item').classList.add('active');        }            }

            

            document.getElementById('loading').style.display = 'none';        }

            document.getElementById('groupContent').style.display = 'block';

            document.getElementById('groupTitle').textContent = `Configura√ß√µes do Grupo: ${groupName}`;        .alert-success {    </style>

            

            // Carregar configura√ß√µes do grupo            border-color: #10b981;</head>

            await loadGroupSettings(groupId);

        }            color: #065f46;<body>



        async function loadGroupSettings(groupId) {            background: #ecfdf5;    <div class="container">

            try {

                const response = await fetch(`/admin/field-locks/api/locks/${groupId}`);        }        <div class="header">

                const locks = await response.json();

                            <h1>üîê Gerenciar Permiss√µes de Campos RNC</h1>

                // Resetar fieldLocks

                fieldLocks = {};        .alert-error {            <p>Clique nos campos abaixo para bloquear/desbloquear o acesso por grupo</p>

                

                // Configurar locks baseado na resposta            border-color: #ef4444;        </div>

                locks.forEach(lock => {

                    fieldLocks[lock.field_name] = lock.is_locked;            color: #991b1b;

                });

                            background: #fef2f2;        <div class="main-content">

                // Atualizar interface visual

                updateFieldDisplay();        }            <div class="sidebar">

                hasChanges = false;

                                <h3>üë• Grupos</h3>

            } catch (error) {

                console.error('Erro ao carregar configura√ß√µes:', error);        @keyframes slideIn {                <input type="text" class="search-box" id="groupSearch" placeholder="Buscar grupo...">

                showAlert('Erro ao carregar configura√ß√µes: ' + error.message, 'error');

            }            from {                <ul class="group-list" id="groupList">

        }

                transform: translateX(100%);                    <!-- Grupos ser√£o carregados via JavaScript -->

        function updateFieldDisplay() {

            availableFields.forEach(fieldName => {                opacity: 0;                </ul>

                const fieldElement = document.querySelector(`[data-field="${fieldName}"]`);

                const statusElement = fieldElement.querySelector('.field-status');            }            </div>

                

                const isLocked = fieldLocks[fieldName] || false;            to {

                

                // Atualizar classes                transform: translateX(0);            <div class="content-area">

                fieldElement.className = `field-preview ${isLocked ? 'locked' : 'unlocked'}`;

                statusElement.className = `field-status ${isLocked ? 'locked' : 'unlocked'}`;                opacity: 1;                <div id="loading" class="loading">

                statusElement.textContent = isLocked ? 'üîí' : 'üîì';

            });            }                    <p>üìã Selecione um grupo para configurar as permiss√µes</p>

        }

        }                </div>

        function toggleField(fieldName) {

            fieldLocks[fieldName] = !fieldLocks[fieldName];

            updateFieldDisplay();

            hasChanges = true;        @media (max-width: 768px) {                <div id="groupContent" style="display: none;">

        }

            .main-content {                    <h3 id="groupTitle">Configura√ß√µes do Grupo</h3>

        async function saveChanges() {

            if (!currentGroupId) {                grid-template-columns: 1fr;                    

                showAlert('Selecione um grupo primeiro', 'error');

                return;                height: auto;                    <div class="actions-bar">

            }

            }                        <button class="btn btn-success" onclick="saveChanges()">üíæ Salvar Altera√ß√µes</button>

            try {

                const locks = availableFields.map(fieldName => ({                                    <button class="btn btn-primary" onclick="unlockAll()">üîì Liberar Todos</button>

                    field_name: fieldName,

                    is_locked: fieldLocks[fieldName] || false            .fields-grid {                        <button class="btn btn-warning" onclick="lockAll()">üîí Bloquear Todos</button>

                }));

                grid-template-columns: 1fr;                        <button class="btn btn-danger" onclick="resetGroup()">üóëÔ∏è Resetar Grupo</button>

                const response = await fetch(`/admin/field-locks/api/locks/${currentGroupId}`, {

                    method: 'PUT',            }                    </div>

                    headers: {

                        'Content-Type': 'application/json'            

                    },

                    body: JSON.stringify({ locks })            .actions-bar {                    <div id="alerts"></div>

                });

                flex-direction: column;

                const result = await response.json();

            }                    <div class="legend">

                if (response.ok) {

                    showAlert('‚úÖ Configura√ß√µes salvas com sucesso!', 'success');        }                        <div class="legend-item">

                    hasChanges = false;

                } else {    </style>                            <div class="legend-color unlocked"></div>

                    throw new Error(result.error || 'Erro desconhecido');

                }</head>                            <span>üîì Campo Liberado (clique para bloquear)</span>



            } catch (error) {<body>                        </div>

                console.error('Erro ao salvar:', error);

                showAlert('‚ùå Erro ao salvar: ' + error.message, 'error');    <div class="container">                        <div class="legend-item">

            }

        }        <div class="header">                            <div class="legend-color locked"></div>



        function unlockAll() {            <h1><i class="fas fa-shield-alt"></i> Gerenciar Permiss√µes de Campos RNC</h1>                            <span>üîí Campo Bloqueado (clique para liberar)</span>

            availableFields.forEach(fieldName => {

                fieldLocks[fieldName] = false;            <p>Configure quais campos cada grupo pode editar durante a cria√ß√£o de RNC</p>                        </div>

            });

            updateFieldDisplay();        </div>                    </div>

            hasChanges = true;

            showAlert('üîì Todos os campos foram liberados', 'success');

        }

        <div class="main-content">                    <div class="rnc-form-preview">

        function lockAll() {

            availableFields.forEach(fieldName => {            <div class="sidebar">                        <div class="section-title">üìã INFORMA√á√ïES PRINCIPAIS DO RNC</div>

                fieldLocks[fieldName] = true;

            });                <h2><i class="fas fa-users"></i> Grupos</h2>                        

            updateFieldDisplay();

            hasChanges = true;                <div class="search-box">                        <div class="form-section">

            showAlert('üîí Todos os campos foram bloqueados', 'success');

        }                    <input type="text" id="groupSearch" placeholder="Buscar grupos...">                            <div class="form-row">



        async function resetGroup() {                    <i class="fas fa-search"></i>                                <div class="field-container">

            if (!currentGroupId) {

                showAlert('Selecione um grupo primeiro', 'error');                </div>                                    <div class="field-preview" data-field="title">

                return;

            }                <ul class="groups-list" id="groupList">                                        <div class="field-label">üìù T√≠tulo do RNC</div>



            const confirm = window.confirm('Tem certeza que deseja resetar todas as configura√ß√µes deste grupo?');                    <li class="no-groups">‚ùå Erro ao carregar grupos</li>                                        <div class="field-placeholder">Ex: Falha no equipamento de produ√ß√£o - Linha A</div>

            if (!confirm) return;

                </ul>                                        <div class="field-status"></div>

            try {

                const response = await fetch(`/admin/field-locks/api/locks/${currentGroupId}`, {            </div>                                    </div>

                    method: 'DELETE'

                });                                </div>



                const result = await response.json();            <div class="content-area">                                <div class="field-container">



                if (response.ok) {                <div class="loading-state" id="loading">                                    <div class="field-preview" data-field="equipment">

                    showAlert('üóëÔ∏è Configura√ß√µes resetadas com sucesso!', 'success');

                    await loadGroupSettings(currentGroupId);                    <i class="fas fa-hand-pointer"></i>                                        <div class="field-label">üîß Equipamento/Sistema</div>

                } else {

                    throw new Error(result.error || 'Erro desconhecido');                    <h3>Selecione um grupo</h3>                                        <div class="field-placeholder">Ex: Linha de montagem A, M√°quina X, Sistema Y</div>

                }

                    <p>Escolha um grupo na lista ao lado para configurar as permiss√µes</p>                                        <div class="field-status"></div>

            } catch (error) {

                console.error('Erro ao resetar:', error);                </div>                                    </div>

                showAlert('‚ùå Erro ao resetar: ' + error.message, 'error');

            }                                </div>

        }

                <div class="group-content" id="groupContent">                                <div class="field-container">

        function showAlert(message, type) {

            const alertsContainer = document.getElementById('alerts');                    <div class="group-header">                                    <div class="field-preview" data-field="client">

            const alertDiv = document.createElement('div');

            alertDiv.className = `alert alert-${type}`;                        <h2 class="group-title" id="groupTitle">Configura√ß√µes do Grupo</h2>                                        <div class="field-label">üè¢ Cliente/Departamento</div>

            alertDiv.textContent = message;

                                </div>                                        <div class="field-placeholder">Selecione o cliente</div>

            alertsContainer.innerHTML = '';

            alertsContainer.appendChild(alertDiv);                                        <div class="field-status"></div>

            

            // Auto-hide success messages                    <div class="stats-container">                                    </div>

            if (type === 'success') {

                setTimeout(() => {                        <div class="stat-card">                                </div>

                    alertDiv.remove();

                }, 5000);                            <div class="stat-number" id="statUnlocked">0</div>                            </div>

            }

        }                            <div class="stat-label">üîì Campos Liberados</div>

    </script>

</body>                        </div>                            <div class="form-row">

</html>
                        <div class="stat-card locked">                                <div class="field-container">

                            <div class="stat-number" id="statLocked">0</div>                                    <div class="field-preview" data-field="description">

                            <div class="stat-label">üîí Campos Bloqueados</div>                                        <div class="field-label">üìÑ Descri√ß√£o</div>

                        </div>                                        <div class="field-placeholder">Descreva brevemente o problema identificado</div>

                    </div>                                        <div class="field-status"></div>

                                    </div>

                    <div class="actions-bar">                                </div>

                        <button class="btn btn-primary" onclick="saveChanges()">                            </div>

                            <i class="fas fa-save"></i> Salvar Altera√ß√µes

                        </button>                            <div class="form-row">

                        <button class="btn btn-success" onclick="unlockAll()">                                <div class="field-container">

                            <i class="fas fa-unlock"></i> Liberar Todos                                    <div class="field-preview" data-field="priority">

                        </button>                                        <div class="field-label">‚ö° N√≠vel de Urg√™ncia</div>

                        <button class="btn btn-danger" onclick="lockAll()">                                        <div class="field-placeholder">üî¥ M√©dia - Resolver em at√© 7 dias</div>

                            <i class="fas fa-lock"></i> Bloquear Todos                                        <div class="field-status"></div>

                        </button>                                    </div>

                        <button class="btn btn-warning" onclick="resetGroup()">                                </div>

                            <i class="fas fa-redo"></i> Resetar                                <div class="field-container">

                        </button>                                    <div class="field-preview" data-field="price">

                    </div>                                        <div class="field-label">üí∞ Custo Estimado (R$)</div>

                                        <div class="field-placeholder">Custo estimado para corre√ß√£o do impacto financeiro</div>

                    <div class="fields-grid">                                        <div class="field-status"></div>

                        <!-- Informa√ß√µes Principais -->                                    </div>

                        <div class="field-category">                                </div>

                            <div class="category-header">                            </div>

                                <i class="fas fa-info-circle" style="color: #3b82f6;"></i>                        </div>

                                Informa√ß√µes Principais

                            </div>                        <div class="section-title">üë• RESPONSABILIDADES</div>

                            <div class="field-item" data-field="rnc_number">                        

                                <span class="field-name">N√∫mero RNC</span>                        <div class="form-section">

                                <span class="field-status">üîì</span>                            <div class="form-row">

                            </div>                                <div class="field-container">

                            <div class="field-item" data-field="title">                                    <div class="field-preview" data-field="responsavel">

                                <span class="field-name">T√≠tulo</span>                                        <div class="field-label">üë§ Respons√°vel pela Detec√ß√£o</div>

                                <span class="field-status">üîì</span>                                        <div class="field-placeholder">Nome do funcion√°rio que detectou</div>

                            </div>                                        <div class="field-status"></div>

                            <div class="field-item" data-field="description">                                    </div>

                                <span class="field-name">Descri√ß√£o</span>                                </div>

                                <span class="field-status">üîì</span>                                <div class="field-container">

                            </div>                                    <div class="field-preview" data-field="inspetor">

                            <div class="field-item" data-field="priority">                                        <div class="field-label">üîç Inspetor</div>

                                <span class="field-name">Prioridade</span>                                        <div class="field-placeholder">Quem identificou o problema</div>

                                <span class="field-status">üîì</span>                                        <div class="field-status"></div>

                            </div>                                    </div>

                            <div class="field-item" data-field="status">                                </div>

                                <span class="field-name">Status</span>                                <div class="field-container">

                                <span class="field-status">üîì</span>                                    <div class="field-preview" data-field="assigned_user_id">

                            </div>                                        <div class="field-label">üìã Atribuir a um Usu√°rio</div>

                            <div class="field-item" data-field="price">                                        <div class="field-placeholder">Filtrar por grupos selecionados</div>

                                <span class="field-name">Pre√ßo</span>                                        <div class="field-status"></div>

                                <span class="field-status">üîì</span>                                    </div>

                            </div>                                </div>

                        </div>                            </div>



                        <!-- Dados T√©cnicos -->                            <div class="form-row">

                        <div class="field-category">                                <div class="field-container">

                            <div class="category-header">                                    <div class="field-preview" data-field="setor">

                                <i class="fas fa-cogs" style="color: #10b981;"></i>                                        <div class="field-label">üè≠ Setor</div>

                                Dados T√©cnicos                                        <div class="field-placeholder">Qual setor onde foi detectado</div>

                            </div>                                        <div class="field-status"></div>

                            <div class="field-item" data-field="equipment">                                    </div>

                                <span class="field-name">Equipamento</span>                                </div>

                                <span class="field-status">üîì</span>                                <div class="field-container">

                            </div>                                    <div class="field-preview" data-field="area_responsavel">

                            <div class="field-item" data-field="material">                                        <div class="field-label">üìç √Årea/Localiza√ß√£o</div>

                                <span class="field-name">Material</span>                                        <div class="field-placeholder">Ex: Setor de Produ√ß√£o, Cap√≠tulo 1, Piso 2</div>

                                <span class="field-status">üîì</span>                                        <div class="field-status"></div>

                            </div>                                    </div>

                            <div class="field-item" data-field="quantity">                                </div>

                                <span class="field-name">Quantidade</span>                            </div>

                                <span class="field-status">üîì</span>                        </div>

                            </div>

                            <div class="field-item" data-field="drawing">                        <div class="section-title">üîß DADOS T√âCNICOS</div>

                                <span class="field-name">Desenho</span>                        

                                <span class="field-status">üîì</span>                        <div class="form-section">

                            </div>                            <div class="form-row">

                            <div class="field-item" data-field="mp">                                <div class="field-container">

                                <span class="field-name">MP</span>                                    <div class="field-preview" data-field="material">

                                <span class="field-status">üîì</span>                                        <div class="field-label">üß± Material</div>

                            </div>                                        <div class="field-placeholder">Descri√ß√£o do material</div>

                            <div class="field-item" data-field="revision">                                        <div class="field-status"></div>

                                <span class="field-name">Revis√£o</span>                                    </div>

                                <span class="field-status">üîì</span>                                </div>

                            </div>                                <div class="field-container">

                            <div class="field-item" data-field="position">                                    <div class="field-preview" data-field="quantity">

                                <span class="field-name">Posi√ß√£o</span>                                        <div class="field-label">üì¶ Quantidade</div>

                                <span class="field-status">üîì</span>                                        <div class="field-placeholder">Quantidade</div>

                            </div>                                        <div class="field-status"></div>

                            <div class="field-item" data-field="cv">                                    </div>

                                <span class="field-name">CV</span>                                </div>

                                <span class="field-status">üîì</span>                                <div class="field-container">

                            </div>                                    <div class="field-preview" data-field="drawing">

                            <div class="field-item" data-field="conjunto">                                        <div class="field-label">üìê Desenho</div>

                                <span class="field-name">Conjunto</span>                                        <div class="field-placeholder">N√∫mero do desenho</div>

                                <span class="field-status">üîì</span>                                        <div class="field-status"></div>

                            </div>                                    </div>

                            <div class="field-item" data-field="modelo">                                </div>

                                <span class="field-name">Modelo</span>                            </div>

                                <span class="field-status">üîì</span>

                            </div>                            <div class="form-row">

                            <div class="field-item" data-field="description_drawing">                                <div class="field-container">

                                <span class="field-name">Descri√ß√£o do Desenho</span>                                    <div class="field-preview" data-field="mp">

                                <span class="field-status">üîì</span>                                        <div class="field-label">üî¢ MP</div>

                            </div>                                        <div class="field-placeholder">C√≥digo MP</div>

                            <div class="field-item" data-field="purchase_order">                                        <div class="field-status"></div>

                                <span class="field-name">Ordem de Compra</span>                                    </div>

                                <span class="field-status">üîì</span>                                </div>

                            </div>                                <div class="field-container">

                        </div>                                    <div class="field-preview" data-field="revision">

                                        <div class="field-label">üîÑ Revis√£o</div>

                        <!-- Responsabilidades -->                                        <div class="field-placeholder">N√∫mero da revis√£o</div>

                        <div class="field-category">                                        <div class="field-status"></div>

                            <div class="category-header">                                    </div>

                                <i class="fas fa-users" style="color: #8b5cf6;"></i>                                </div>

                                Responsabilidades                                <div class="field-container">

                            </div>                                    <div class="field-preview" data-field="position">

                            <div class="field-item" data-field="assigned_user_id">                                        <div class="field-label">üìç Posi√ß√£o</div>

                                <span class="field-name">Usu√°rio Atribu√≠do</span>                                        <div class="field-placeholder">Posi√ß√£o no equipamento</div>

                                <span class="field-status">üîì</span>                                        <div class="field-status"></div>

                            </div>                                    </div>

                            <div class="field-item" data-field="responsavel">                                </div>

                                <span class="field-name">Respons√°vel</span>                            </div>

                                <span class="field-status">üîì</span>

                            </div>                            <div class="form-row">

                            <div class="field-item" data-field="inspetor">                                <div class="field-container">

                                <span class="field-name">Inspetor</span>                                    <div class="field-preview" data-field="cv">

                                <span class="field-status">üîì</span>                                        <div class="field-label">üìã CV</div>

                            </div>                                        <div class="field-placeholder">C√≥digo CV</div>

                            <div class="field-item" data-field="setor">                                        <div class="field-status"></div>

                                <span class="field-name">Setor</span>                                    </div>

                                <span class="field-status">üîì</span>                                </div>

                            </div>                                <div class="field-container">

                            <div class="field-item" data-field="area_responsavel">                                    <div class="field-preview" data-field="conjunto">

                                <span class="field-name">√Årea Respons√°vel</span>                                        <div class="field-label">üîó Conjunto</div>

                                <span class="field-status">üîì</span>                                        <div class="field-placeholder">Nome do conjunto</div>

                            </div>                                        <div class="field-status"></div>

                            <div class="field-item" data-field="client">                                    </div>

                                <span class="field-name">Cliente</span>                                </div>

                                <span class="field-status">üîì</span>                                <div class="field-container">

                            </div>                                    <div class="field-preview" data-field="modelo">

                        </div>                                        <div class="field-label">üéØ Modelo</div>

                                        <div class="field-placeholder">Modelo do equipamento</div>

                        <!-- Disposi√ß√µes -->                                        <div class="field-status"></div>

                        <div class="field-category">                                    </div>

                            <div class="category-header">                                </div>

                                <i class="fas fa-clipboard-check" style="color: #f59e0b;"></i>                            </div>

                                Disposi√ß√µes

                            </div>                            <div class="form-row">

                            <div class="field-item" data-field="disposition_usar">                                <div class="field-container">

                                <span class="field-name">Usar</span>                                    <div class="field-preview" data-field="description_drawing">

                                <span class="field-status">üîì</span>                                        <div class="field-label">üìù Descri√ß√£o do Desenho</div>

                            </div>                                        <div class="field-placeholder">Descri√ß√£o detalhada do desenho</div>

                            <div class="field-item" data-field="disposition_retrabalhar">                                        <div class="field-status"></div>

                                <span class="field-name">Retrabalhar</span>                                    </div>

                                <span class="field-status">üîì</span>                                </div>

                            </div>                                <div class="field-container">

                            <div class="field-item" data-field="disposition_rejeitar">                                    <div class="field-preview" data-field="purchase_order">

                                <span class="field-name">Rejeitar</span>                                        <div class="field-label">üõí Ordem de Compra</div>

                                <span class="field-status">üîì</span>                                        <div class="field-placeholder">N√∫mero da ordem de compra</div>

                            </div>                                        <div class="field-status"></div>

                            <div class="field-item" data-field="disposition_sucata">                                    </div>

                                <span class="field-name">Sucata</span>                                </div>

                                <span class="field-status">üîì</span>                            </div>

                            </div>

                            <div class="field-item" data-field="disposition_devolver_estoque">                            <div class="form-row">

                                <span class="field-name">Devolver ao Estoque</span>                                <div class="field-container">

                                <span class="field-status">üîì</span>                                    <div class="field-preview" data-field="justificativa">

                            </div>                                        <div class="field-label">üí≠ Justificativa</div>

                            <div class="field-item" data-field="disposition_devolver_fornecedor">                                        <div class="field-placeholder">Justificativa para o RNC</div>

                                <span class="field-name">Devolver ao Fornecedor</span>                                        <div class="field-status"></div>

                                <span class="field-status">üîì</span>                                    </div>

                            </div>                                </div>

                        </div>                            </div>

                        </div>

                        <!-- Inspe√ß√£o -->                    </div>

                        <div class="field-category">                </div>

                            <div class="category-header">            </div>

                                <i class="fas fa-search" style="color: #ef4444;"></i>        </div>

                                Inspe√ß√£o    </div>

                            </div>

                            <div class="field-item" data-field="inspection_aprovado">    <script>

                                <span class="field-name">Aprovado</span>        let currentGroupId = null;

                                <span class="field-status">üîì</span>        let fieldLocks = {};

                            </div>        let hasChanges = false;

                            <div class="field-item" data-field="inspection_reprovado">

                                <span class="field-name">Reprovado</span>        // Campos dispon√≠veis no sistema

                                <span class="field-status">üîì</span>        const availableFields = [

                            </div>            'title', 'description', 'priority', 'price', 'responsavel', 'inspetor', 

                            <div class="field-item" data-field="inspection_ver_rnc">            'setor', 'area_responsavel', 'equipment', 'client', 'assigned_user_id',

                                <span class="field-name">Ver RNC</span>            'material', 'quantity', 'drawing', 'mp', 'revision', 'position', 

                                <span class="field-status">üîì</span>            'cv', 'conjunto', 'modelo', 'description_drawing', 'purchase_order', 'justificativa'

                            </div>        ];

                        </div>

        // Carregar grupos na inicializa√ß√£o

                        <!-- Assinaturas -->        document.addEventListener('DOMContentLoaded', function() {

                        <div class="field-category">            loadGroups();

                            <div class="category-header">            setupEventListeners();

                                <i class="fas fa-signature" style="color: #6366f1;"></i>        });

                                Assinaturas

                            </div>        function setupEventListeners() {

                            <div class="field-item" data-field="signature_inspection_name">            // Search functionality

                                <span class="field-name">Nome da Inspe√ß√£o</span>            document.getElementById('groupSearch').addEventListener('input', function(e) {

                                <span class="field-status">üîì</span>                filterGroups(e.target.value);

                            </div>            });

                            <div class="field-item" data-field="signature_inspection_date">

                                <span class="field-name">Data da Inspe√ß√£o</span>            // Field click handlers

                                <span class="field-status">üîì</span>            document.querySelectorAll('.field-preview').forEach(field => {

                            </div>                field.addEventListener('click', function() {

                            <div class="field-item" data-field="signature_engineering_name">                    if (currentGroupId) {

                                <span class="field-name">Nome da Engenharia</span>                        toggleField(this.dataset.field);

                                <span class="field-status">üîì</span>                    }

                            </div>                });

                            <div class="field-item" data-field="signature_engineering_date">            });

                                <span class="field-name">Data da Engenharia</span>

                                <span class="field-status">üîì</span>            // Warning on page leave if there are unsaved changes

                            </div>            window.addEventListener('beforeunload', function(e) {

                            <div class="field-item" data-field="signature_inspection2_name">                if (hasChanges) {

                                <span class="field-name">Nome da Inspe√ß√£o 2</span>                    e.preventDefault();

                                <span class="field-status">üîì</span>                    e.returnValue = 'Voc√™ tem altera√ß√µes n√£o salvas. Deseja continuar?';

                            </div>                }

                            <div class="field-item" data-field="signature_inspection2_date">            });

                                <span class="field-name">Data da Inspe√ß√£o 2</span>        }

                                <span class="field-status">üîì</span>

                            </div>        async function loadGroups() {

                        </div>            try {

                const response = await fetch('/admin/field-locks/api/groups');

                        <!-- An√°lises -->                const groups = await response.json();

                        <div class="field-category">                

                            <div class="category-header">                const groupList = document.getElementById('groupList');

                                <i class="fas fa-chart-line" style="color: #14b8a6;"></i>                groupList.innerHTML = '';

                                An√°lises                

                            </div>                groups.forEach(group => {

                            <div class="field-item" data-field="instruction_retrabalho">                    const li = document.createElement('li');

                                <span class="field-name">Instru√ß√£o de Retrabalho</span>                    li.className = 'group-item';

                                <span class="field-status">üîì</span>                    li.onclick = () => selectGroup(group.id, group.name);

                            </div>                    

                            <div class="field-item" data-field="cause_rnc">                    li.innerHTML = `

                                <span class="field-name">Causa da RNC</span>                        <div class="group-name">${group.name}</div>

                                <span class="field-status">üîì</span>                        <div class="group-desc">${group.description || 'Sem descri√ß√£o'}</div>

                            </div>                    `;

                            <div class="field-item" data-field="action_rnc">                    

                                <span class="field-name">A√ß√£o da RNC</span>                    groupList.appendChild(li);

                                <span class="field-status">üîì</span>                });

                            </div>                

                            <div class="field-item" data-field="justificativa">            } catch (error) {

                                <span class="field-name">Justificativa</span>                console.error('Erro ao carregar grupos:', error);

                                <span class="field-status">üîì</span>                showAlert('Erro ao carregar grupos: ' + error.message, 'error');

                            </div>            }

                        </div>        }

                    </div>

                </div>        function filterGroups(searchTerm) {

            </div>            const groups = document.querySelectorAll('.group-item');

        </div>            const term = searchTerm.toLowerCase();

    </div>            

            groups.forEach(group => {

    <div class="alerts" id="alerts"></div>                const text = group.textContent.toLowerCase();

                group.style.display = text.includes(term) ? 'block' : 'none';

    <script>            });

        let currentGroupId = null;        }

        let fieldLocks = {};

        let hasChanges = false;        async function selectGroup(groupId, groupName) {

            // Verificar se h√° mudan√ßas n√£o salvas

        const availableFields = [            if (hasChanges) {

            'rnc_number', 'title', 'description', 'priority', 'status', 'price',                const confirm = window.confirm('Voc√™ tem altera√ß√µes n√£o salvas. Deseja continuar sem salvar?');

            'equipment', 'material', 'quantity', 'drawing', 'mp', 'revision', 'position',                 if (!confirm) return;

            'cv', 'conjunto', 'modelo', 'description_drawing', 'purchase_order',            }

            'assigned_user_id', 'responsavel', 'inspetor', 'setor', 'area_responsavel', 'client',

            'disposition_usar', 'disposition_retrabalhar', 'disposition_rejeitar',             currentGroupId = groupId;

            'disposition_sucata', 'disposition_devolver_estoque', 'disposition_devolver_fornecedor',            

            'inspection_aprovado', 'inspection_reprovado', 'inspection_ver_rnc',            // Atualizar UI

            'signature_inspection_name', 'signature_inspection_date', 'signature_engineering_name',            document.querySelectorAll('.group-item').forEach(item => {

            'signature_engineering_date', 'signature_inspection2_name', 'signature_inspection2_date',                item.classList.remove('active');

            'instruction_retrabalho', 'cause_rnc', 'action_rnc', 'justificativa'            });

        ];            

            event.target.closest('.group-item').classList.add('active');

        document.addEventListener('DOMContentLoaded', function() {            

            loadGroups();            document.getElementById('loading').style.display = 'none';

            setupEventListeners();            document.getElementById('groupContent').style.display = 'block';

        });            document.getElementById('groupTitle').textContent = `Configura√ß√µes do Grupo: ${groupName}`;

            

        function setupEventListeners() {            // Carregar configura√ß√µes do grupo

            document.getElementById('groupSearch').addEventListener('input', function(e) {            await loadGroupSettings(groupId);

                filterGroups(e.target.value);        }

            });

                    async function loadGroupSettings(groupId) {

            document.querySelectorAll('.field-item').forEach(field => {            try {

                field.addEventListener('click', function() {                const response = await fetch(`/admin/field-locks/api/locks/${groupId}`);

                    if (currentGroupId) toggleField(this.dataset.field);                const locks = await response.json();

                });                

            });                // Resetar fieldLocks

        }                fieldLocks = {};

                

        async function loadGroups() {                // Configurar locks baseado na resposta

            try {                locks.forEach(lock => {

                const response = await fetch('/admin/field-locks/api/groups');                    fieldLocks[lock.field_name] = lock.is_locked;

                const groups = await response.json();                });

                const groupList = document.getElementById('groupList');                

                groupList.innerHTML = '';                // Atualizar interface visual

                                updateFieldDisplay();

                if (groups.length === 0) {                hasChanges = false;

                    groupList.innerHTML = '<li class="no-groups">üì≠ Nenhum grupo encontrado</li>';                

                    return;            } catch (error) {

                }                console.error('Erro ao carregar configura√ß√µes:', error);

                                showAlert('Erro ao carregar configura√ß√µes: ' + error.message, 'error');

                groups.forEach(group => {            }

                    const li = document.createElement('li');        }

                    li.className = 'group-item';

                    li.onclick = () => selectGroup(group.id, group.name);        function updateFieldDisplay() {

                    li.innerHTML = `            availableFields.forEach(fieldName => {

                        <div class="group-name">${group.name}</div>                const fieldElement = document.querySelector(`[data-field="${fieldName}"]`);

                        <div class="group-desc">${group.description || 'Sem descri√ß√£o'}</div>                const statusElement = fieldElement.querySelector('.field-status');

                    `;                

                    groupList.appendChild(li);                const isLocked = fieldLocks[fieldName] || false;

                });                

            } catch (error) {                // Atualizar classes

                showAlert('‚ùå Erro ao carregar grupos: ' + error.message, 'error');                fieldElement.className = `field-preview ${isLocked ? 'locked' : 'unlocked'}`;

            }                statusElement.className = `field-status ${isLocked ? 'locked' : 'unlocked'}`;

        }                statusElement.textContent = isLocked ? 'üîí' : 'üîì';

            });

        function filterGroups(searchTerm) {        }

            const groups = document.querySelectorAll('.group-item');

            const term = searchTerm.toLowerCase();        function toggleField(fieldName) {

            groups.forEach(group => {            fieldLocks[fieldName] = !fieldLocks[fieldName];

                const text = group.textContent.toLowerCase();            updateFieldDisplay();

                group.style.display = text.includes(term) ? 'block' : 'none';            hasChanges = true;

            });        }

        }

        async function saveChanges() {

        async function selectGroup(groupId, groupName) {            if (!currentGroupId) {

            currentGroupId = groupId;                showAlert('Selecione um grupo primeiro', 'error');

            document.querySelectorAll('.group-item').forEach(item => item.classList.remove('active'));                return;

            event.target.closest('.group-item').classList.add('active');            }

            

            document.getElementById('loading').style.display = 'none';            try {

            document.getElementById('groupContent').style.display = 'block';                const locks = availableFields.map(fieldName => ({

            document.getElementById('groupTitle').textContent = `Configura√ß√µes: ${groupName}`;                    field_name: fieldName,

                                is_locked: fieldLocks[fieldName] || false

            await loadGroupSettings(groupId);                }));

        }

                const response = await fetch(`/admin/field-locks/api/locks/${currentGroupId}`, {

        async function loadGroupSettings(groupId) {                    method: 'PUT',

            try {                    headers: {

                const response = await fetch(`/admin/field-locks/api/locks/${groupId}`);                        'Content-Type': 'application/json'

                const locks = await response.json();                    },

                                    body: JSON.stringify({ locks })

                fieldLocks = {};                });

                locks.forEach(lock => {

                    fieldLocks[lock.field_name] = lock.is_locked;                const result = await response.json();

                });

                                if (response.ok) {

                updateFieldDisplay();                    showAlert('‚úÖ Configura√ß√µes salvas com sucesso!', 'success');

                updateStats();                    hasChanges = false;

                hasChanges = false;                } else {

            } catch (error) {                    throw new Error(result.error || 'Erro desconhecido');

                showAlert('‚ùå Erro ao carregar configura√ß√µes: ' + error.message, 'error');                }

            }

        }            } catch (error) {

                console.error('Erro ao salvar:', error);

        function updateFieldDisplay() {                showAlert('‚ùå Erro ao salvar: ' + error.message, 'error');

            availableFields.forEach(fieldName => {            }

                const fieldElement = document.querySelector(`[data-field="${fieldName}"]`);        }

                if (!fieldElement) return;

                        function unlockAll() {

                const statusElement = fieldElement.querySelector('.field-status');            availableFields.forEach(fieldName => {

                const isLocked = fieldLocks[fieldName] || false;                fieldLocks[fieldName] = false;

                            });

                fieldElement.className = `field-item ${isLocked ? 'locked' : 'unlocked'}`;            updateFieldDisplay();

                statusElement.className = `field-status ${isLocked ? 'locked' : 'unlocked'}`;            hasChanges = true;

                statusElement.textContent = isLocked ? 'üîí' : 'üîì';            showAlert('üîì Todos os campos foram liberados', 'success');

            });        }

        }

        function lockAll() {

        function updateStats() {            availableFields.forEach(fieldName => {

            const locked = availableFields.filter(field => fieldLocks[field]).length;                fieldLocks[fieldName] = true;

            const unlocked = availableFields.length - locked;            });

            document.getElementById('statLocked').textContent = locked;            updateFieldDisplay();

            document.getElementById('statUnlocked').textContent = unlocked;            hasChanges = true;

        }            showAlert('üîí Todos os campos foram bloqueados', 'success');

        }

        function toggleField(fieldName) {

            fieldLocks[fieldName] = !fieldLocks[fieldName];        async function resetGroup() {

            updateFieldDisplay();            if (!currentGroupId) {

            updateStats();                showAlert('Selecione um grupo primeiro', 'error');

            hasChanges = true;                return;

        }            }



        async function saveChanges() {            const confirm = window.confirm('Tem certeza que deseja resetar todas as configura√ß√µes deste grupo?');

            if (!currentGroupId) {            if (!confirm) return;

                showAlert('‚ö†Ô∏è Selecione um grupo primeiro', 'error');

                return;            try {

            }                const response = await fetch(`/admin/field-locks/api/locks/${currentGroupId}`, {

                                method: 'DELETE'

            try {                });

                const locks = availableFields.map(fieldName => ({

                    field_name: fieldName,                const result = await response.json();

                    is_locked: fieldLocks[fieldName] || false

                }));                if (response.ok) {

                                    showAlert('üóëÔ∏è Configura√ß√µes resetadas com sucesso!', 'success');

                const response = await fetch(`/admin/field-locks/api/locks/${currentGroupId}`, {                    await loadGroupSettings(currentGroupId);

                    method: 'PUT',                } else {

                    headers: { 'Content-Type': 'application/json' },                    throw new Error(result.error || 'Erro desconhecido');

                    body: JSON.stringify({ locks })                }

                });

                            } catch (error) {

                const result = await response.json();                console.error('Erro ao resetar:', error);

                if (response.ok) {                showAlert('‚ùå Erro ao resetar: ' + error.message, 'error');

                    showAlert('‚úÖ Configura√ß√µes salvas com sucesso!', 'success');            }

                    hasChanges = false;        }

                } else {

                    throw new Error(result.error || 'Erro desconhecido');        function showAlert(message, type) {

                }            const alertsContainer = document.getElementById('alerts');

            } catch (error) {            const alertDiv = document.createElement('div');

                showAlert('‚ùå Erro ao salvar: ' + error.message, 'error');            alertDiv.className = `alert alert-${type}`;

            }            alertDiv.textContent = message;

        }            

            alertsContainer.innerHTML = '';

        function unlockAll() {            alertsContainer.appendChild(alertDiv);

            availableFields.forEach(fieldName => {            

                fieldLocks[fieldName] = false;            // Auto-hide success messages

            });            if (type === 'success') {

            updateFieldDisplay();                setTimeout(() => {

            updateStats();                    alertDiv.remove();

            hasChanges = true;                }, 5000);

            showAlert('üîì Todos os campos foram liberados', 'success');            }

        }        }

    </script>

        function lockAll() {</body>

            availableFields.forEach(fieldName => {</html>
                fieldLocks[fieldName] = true;
            });
            updateFieldDisplay();
            updateStats();
            hasChanges = true;
            showAlert('üîí Todos os campos foram bloqueados', 'success');
        }

        async function resetGroup() {
            if (!currentGroupId) {
                showAlert('‚ö†Ô∏è Selecione um grupo primeiro', 'error');
                return;
            }
            
            if (!confirm('üóëÔ∏è Tem certeza que deseja resetar todas as configura√ß√µes deste grupo?')) return;
            
            try {
                const response = await fetch(`/admin/field-locks/api/locks/${currentGroupId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                if (response.ok) {
                    showAlert('üóëÔ∏è Configura√ß√µes resetadas com sucesso!', 'success');
                    await loadGroupSettings(currentGroupId);
                } else {
                    throw new Error(result.error || 'Erro desconhecido');
                }
            } catch (error) {
                showAlert('‚ùå Erro ao resetar: ' + error.message, 'error');
            }
        }

        function showAlert(message, type) {
            const alertsContainer = document.getElementById('alerts');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            alertsContainer.appendChild(alertDiv);
            
            if (type === 'success') {
                setTimeout(() => {
                    alertDiv.remove();
                }, 5000);
            }
        }
    </script>
</body>
</html>